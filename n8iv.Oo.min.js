!function(a){var b=!1,c=null,d=!0,e,f="cw",g="r",h="array",i="constructor",j="function",k="length",l="object",m=c+l,n="prototype",o="__type__";!function(){function h(b,c){!c&&a.isObj(b)&&(c=b,b="");var e,h,j,k,l=a.obj(),u=c.extend||Object,w=c.module,x=c.mixin||E,y=c.singleton,z=t(c.type||b);return!a.isStr(u)||(u=I[u]||J[u]),k=c[i]!==Object?c[i]:u,b&&(j=b.split("."),h=j.pop(),j=a.bless(j,w)),a.def(l,A,a.describe(a.noop,f),d),a.def(l,i,a.describe(q(k,u[n][i],h,l),g),d),e=l[i],a.def(e,o,a.describe("class",g),d),a.def(l,o,a.describe(z,g),d),Object.remove(c,C),e[n]=m(l,a.copy(c,x)),a.def(e,"create",a.describe(p(s(e,u)),g),d),b=b.replace(H,""),y?(a.def(e,"singleton",a.describe({value:y===d?new e:e.create.apply(e,[].concat(y))},g)),v(e,b,z),e=e.singleton):b&&v(e,b,z),!h||!j||a.def(j,h,a.describe({value:e},g)),e}function m(b,c){return Object.each(c,function(c,e){switch(a.type(c)){case l:a.def(b,e,c,d);break;default:b[e]=c}}),b}function p(a){return function(){return w(a)||a.apply(Object.create(a[n]),arguments)}}function q(a,b,c,d){var e=y(a,b,c),f=function(){return w(this.constructor)||e.apply(u(this,f)?this:Object.create(d),arguments)};return f.mimic(a,c)}function s(b,c){if(!(B in b[n])){var e=b[n],f=c[n];Object.keys(f).forEach(function(b){if(b in K)return;switch(a.type(f[b])){case j:e[b]=a.isFn(e[b])?y(e[b],f[b],b):y(f[b],a.noop,b);break;default:b in e||a.def(e,b,a.description(f,b),d)}}),Object.keys(e).forEach(function(b){!a.isFn(e[b])||b in f&&e[b].valueOf()===f[b].valueOf()||(e[b]=y(e[b],a.noop,b))}),f=a.describe({value:Object.create(c[n])},g),a.def(b,B,f),a.def(b[n],B,f)}return b}function t(a){return a.replace(H,"").replace(G,"_").lc()}function u(a,c){if(a instanceof c)return d;if(!(a=a[i]))return b;do if(a===c)return d;while(a[B]&&(a=a[B][i]));return b}function v(b,c,e){var f=c+z,g=[];!c||!(c in I)||g.push(f+"Class"),!e||!(e in J)||g.push(f+"Type"),g[k]&&(a.trace(),g.forEach(a.error),a.error(new Error("n8iv.Class overwrite error."),d)),I[c]=J[e]=b}function w(a){return a?a.singleton||c:c}function x(a){var b=a[i],d;for(d in I)if(I[d]===b)return d;return c}function y(c,g,h){return function(){var h,i=a.description(this,A)||D;return i.writable=d,a.def(this,A,g?a.describe(g,f):D,d),h=c.apply(this,arguments),a.def(this,A,i,d),this.chain!==b&&h===e?this:h}.mimic(c,h)}var z=" already exists. Cannot override existing ",A="parent",B="__super",C=(i+" extend mixin module singleton type").split(" "),D=a.describe(a.noop,f),E=a.obj(),G=/\./g,H=/^\u005E/,I=a.obj(),J=a.obj(),K=a.obj();K[i]=K[A]=K[B]=K[o]=d,a.def(h,"is",a.describe(u,g)).def(h,"type",a.describe(x,g)).def(a,"Class",a.describe(h,g)).def(a,"create",a.describe(function(b){var c=J[b]||J["n8iv_"+b]||I[b],e=Array.from(arguments,1);return c||a.trace().error(new Error(b+" does not match any registered n8iv.Classes."),d),c.create.apply(a.global,e)},g))}(),a.Class("n8iv.Callback",function(){function e(){return i in this?this:(this[i]=setTimeout(f.bind(this),this.buffer),this.exec.apply(this,arguments))}function f(){clearTimeout(this[i]),delete this[i]}function h(){return this.fire.apply(this,arguments)}a.def(Function[n],"callback",a.describe(function(b){return(new a.Callback(this,b)).fire.mimic(this)},g));var i="bufferId",j="handleEvent";return{constructor:function(d,f){a.copy(this,f||a.obj());var h=a.describe(c,g),i=(a.isNum(this.buffer)?e:this.exec).bind(this);h.value=d,a.def(this,"fn",h),h.value=this,a.def(i,"cb",h),h.value=i,a.def(this,"fire",h),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.isNum(this.delay)||(this.delay=c),a.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:d,buffer:c,count:0,delay:c,times:0,disable:function(){this.disabled=d,this[j]=a.noop},enable:function(){this.disabled=b,this[j]=h},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var b=Array.from(arguments),d=this.ctx,e=this.delay,f=a.type(b[0]),g;return f&&(f.endsWith("event")||f=="n8iv_observer")?b.splice.apply(b,[1,0].concat(this.args)):b.unshift.apply(b,this.args),e===c?g=this.fn.apply(d,b):this.fn.delay.apply(this.fn,[e,d].concat(b)),g},reset:function(){this.count=0,f.call(this.enable())}}}()),a.Class("n8iv.Hash",function(){var d="__hashid__",e=[];return{constructor:function(c){a.def(this,d,a.describe(e.push(a.obj())-1,g)),!a.isObj(c)||this.set(c)},keys:{get:function(){return Object.keys(e[this[d]])}},length:{get:function(){return this.keys[k]}},values:{get:function(){return Object.values(e[this[d]])}},aggregate:function(a,b,c){var f=this,g=e[this[d]];return c||(c=f),Object.keys(g).reduce(function(a,d,e){return b.call(c,a,g[d],d,f,e)},a)},clear:function(){e[this[d]]=a.obj()},clone:function(){return new a.Hash(Object.clone(e[this[d]]))},each:function(a,b){var c=this,f=e[this[d]];return b||(b=c),Object.keys(f).forEach(function(d,e){a.call(b,f[d],d,c,e)},c),c},get:function(b){return a.has(e[this[d]],b)?e[this[d]][b]:c},has:function(b){return a.has(e[this[d]],b)},key:function(a){return Object.key(e[this[d]],a)},reduce:function(a,b){var c=this,f=e[this[d]];return Object.keys(f).reduce(function(b,d,e){return a.call(c,b,f[d],d,c,e)},b)},remove:function(c){return a.has(e[this[d]],c)?delete e[this[d]][c]:b},set:function(b,c){switch(a.type(b)){case l:case m:Object.keys(b).forEach(function(a){this.set(a,b[a])},this);break;default:e[this[d]][b]=c}},stringify:function(){return JSON.stringify(e[this[d]])},toString:function(){return a.tostr(e[this[d]])},valueOf:function(){return Object.clone(e[this[d]])}}}()),a.Class("n8iv.Observer",function(){function e(b){b=Object.clone(b);var c=b[t],d,e,f,g=b[x],i;Object.remove(b,t,x);for(d in b){e=b[d],f=a.isUndef(e[x])?g:e[x],i=a.isUndef(e[t])?c:e[t];switch(a.type(e)){case j:this.on(d,e,c,g);break;case l:case m:switch(a.type(e[v])){case j:case l:case m:this.on(d,e[v],i,f);break;case h:e[v].forEach(function(a){this.on(d,a,i,f)},this)}break;case h:e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function f(c){var e=this.args.concat(c[x].args),f=c[t]||this[t],g=c.fire||c[v];return a.isFn(g)?(Object.key(this[t],c[v])?e[0]!==this[t]||e.shift():e[0]!==this[t]&&e.unshift(this[t]),g.apply(f,e)!==b):d}function g(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),r.apply(b,e)}}function i(a,b){var c=this;return b.fire=function(){c.un(a,b[v],b[t]);if(b.fired)return;return b.fired=d,b[v].apply(b[t]||c,arguments)}}function n(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function o(b,e,f){b=b.lc();var g=this[w].get(b),h,i;if(!g)return;switch(a.type(e)){case"n8iv_callback":i={ctx:e,isCB:d};break;default:i={ctx:f||this,fn:e}}i.event=b,i=g.find(p,i),i!==c&&(h=g.indexOf(i),h<0||g.splice(h,1))}function p(a){return(this.isCB===d?a[v].valueOf()===this[t].fire:a[v]===this[v])&&a[t]===this[t]&&a.event===this.event}function q(b,c,d,f){var g,j=this[w],k,o;if(a.isObj(b))return e.call(this,b);switch(k=a.nativeType(c)){case h:return g=a.obj(),g[b]={fn:c,options:f,ctx:d},e.call(this,g);case l:case m:case"n8iv_callback":"handleEvent"in c&&(!a.isObj(d)||!a.isUndef(f)||(f=d),d=c,c=n(c));break;case"string":!d||(c=d[c])}b=b.lc(),(o=j.get(b))||j.set(b,o=[]);switch(a.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case l:case m:f=Object.clone(f);break;default:f=a.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:d||this,event:b,fn:c,id:++z,options:f},g.fire=(f.single?i.call(this,b,g):g[v]).callback({args:f.args,buffer:f.buffer,ctx:g[t],delay:f.delay}),o.push(g)}function r(){return this.broadcast.apply(this,arguments)}var s="broadcasting",t="ctx",u="destroyed",v="fn",w="listeners",x="options",y="observer_suspended",z=0;return{constructor:function(d){this[s]=b,this[u]=b,this[y]=b,this[w]=a.Hash.create(),!a.isObj(d)||this.on(d),!a.isObj(this.observers)||this.on(this.observers),delete this.observers},broadcast:function(a){if(this[u]||this[y]||!this[w][k]||!a||!this[w].has(a=a.lc()))return;var c=Array.from(arguments,1),d=this[w].get(a).clone();if(!d[k])return;this[s]=a,d.every(f,{args:c,ctx:this}),this[s]=b},buffer:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.buffer=Number.toInteger(b),this.on(c,d,e,f)},delay:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.delay=Number.toInteger(b),this.on(c,d,e,f)},destroy:function(){return this[u]?d:this.broadcast("before:destroy")===b?b:(this[u]=d,this._destroy(),this.broadcast("destroy"),this[y]=d,delete this[w],d)},ignore:o,observe:q,on:q,once:function(b,c,e,f){a.isObj(f)||(f=a.obj()),f.single=d,this.on(b,c,e,f)},purgeObservers:function(a){var b=this[w];if(!a){b.clear();return}a=a.lc(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,g(this,a,c),a)},resumeEvents:function(){!this[y]||(this[y]=b,this.broadcast("observer:resumed"))},suspendEvents:function(){this[y]||(this[y]=d,this.broadcast("observer:suspended"))},un:o,_destroy:a.noop}}()),a.ENV!="commonjs"||module.exports===a||(module.exports=a)}(typeof n8iv!="undefined"?n8iv:typeof require!="undefined"?require("./n8iv._"):N)
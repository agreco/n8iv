!function(a,b){var c=!1,d=null,e=!0,f,g="cw",h="r",i="array",j="constructor",k="function",l="length",m="object",n=d+m,o="prototype",p="__type__";!function(){function i(a,c){!c&&b.isObj(a)&&(c=a,a="");var d,f,i,k=c[j],m=b.obj(),w=c.extend||Object,y=u(c.module),z=c.mixin||I,A=c.singleton,B=v(c.type||a);return!b.isStr(w)||(w=L[w]||M[w]),a&&(i=a.split("."),f=i.pop(),!i[l]||!i[0].startsWith("^")||(y?i.shift():i[0]=i[0].substring(1)),i=b.bless(i,y)),b.def(m,C,b.describe(b.noop,g),e),b.def(m,j,b.describe(s(k,w[o][j],f,m),h),e),d=m[j],b.def(d,p,b.describe("class",h),e),b.def(m,p,b.describe(B,h),e),Object.remove(c,G),d[o]=n(m,b.copy(c,z)),b.def(d,"create",b.describe(q(t(d,w)),h),e),a=a.replace(K,""),A?(b.def(d,"singleton",b.describe({value:A===e?new d:d.create.apply(d,[].concat(A))},h)),x(d,a,B),d=d.singleton):a&&x(d,a,B),!f||!i||b.def(i,f,b.describe({value:d},h)),d}function n(a,c){return Object.each(c,function(c,d){switch(b.type(c)){case m:b.def(a,d,c,e);break;default:a[d]=c}}),a}function q(a){return function(){return y(a)||a.apply(Object.create(a[o]),arguments)}}function s(a,b,c,d){var e=A(a,b,c),f=function(){return y(this.constructor)||e.apply(w(this,f)?this:Object.create(d),arguments)};return f.mimic(a,c)}function t(a,c){if(!(D in a[o])){var d=a[o],f=c[o];Object.keys(f).forEach(function(a){if(a in O)return;switch(b.type(f[a])){case k:d[a]=b.isFn(d[a])?A(d[a],f[a],a):A(f[a],b.noop,a);break;default:a in d||b.def(d,a,b.description(f,a),e)}}),Object.keys(d).forEach(function(a){!b.isFn(d[a])||a in f&&d[a].valueOf()===f[a].valueOf()||(d[a]=A(d[a],b.noop,a))}),f=b.describe({value:Object.create(c[o])},h),b.def(a,D,f),b.def(a[o],D,f)}return a}function u(a){return a?E&&a instanceof E?a.exports||(a.exports=b.obj()):a:d}function v(a){return a.replace(K,"").replace(J,"_").lc()}function w(a,b){if(a instanceof b)return e;if(!(a=a[j]))return c;do if(a===b)return e;while(a[D]&&(a=a[D][j]));return c}function x(a,c,d){var f=c+B,g=[];!c||!(c in L)||g.push(f+"Class"),!d||!(d in M)||g.push(f+"Type"),g[l]&&(b.trace(),g.forEach(b.error),b.error(new Error("n8iv.Class overwrite error."),e)),L[c]=M[d]=a}function y(a){return a?a.singleton||d:d}function z(a){var b=a[j],c;for(c in L)if(L[c]===b)return c;return d}function A(a,d,h){return function(){var h,i=b.description(this,C)||H;return i.writable=e,b.def(this,C,d?b.describe(d,g):H,e),h=a.apply(this,arguments),b.def(this,C,i,e),this.chain!==c&&h===f?this:h}.mimic(a,h)}var B=" already exists. Cannot override existing ",C="parent",D="__super",E=b.ENV!="commonjs"?d:require("module"),G=(j+" extend mixin module singleton type").split(" "),H=b.describe(b.noop,g),I=b.obj(),J=/\./g,K=/^\u005E/,L=b.obj(),M=b.obj(),O=b.obj();O[j]=O[C]=O[D]=O[p]=e,b.def(i,"is",b.describe(w,h)).def(i,"type",b.describe(z,h)).def(b,"Class",b.describe(i,h)).def(b,"create",b.describe(function(c){var d=M[c]||M["n8iv_"+c]||L[c],f=Array.from(arguments,1);return d||b.trace().error(new Error(c+" does not match any registered n8iv.Classes."),e),d.create.apply(a,f)},h))}(),b.Class("n8iv.Callback",function(){function a(){return i in this?this:(this[i]=setTimeout(f.bind(this),this.buffer),this.exec.apply(this,arguments))}function f(){clearTimeout(this[i]),delete this[i]}function g(){return this.fire.apply(this,arguments)}b.def(Function[o],"callback",b.describe(function(a){return(new b.Callback(this,a)).fire.mimic(this)},h));var i="bufferId",j="handleEvent";return{constructor:function(e,f){b.copy(this,f||b.obj());var g=b.describe(d,h),i=(b.isNum(this.buffer)?a:this.exec).bind(this);g.value=e,b.def(this,"fn",g),g.value=this,b.def(i,"cb",g),g.value=i,b.def(this,"fire",g),this.args||(this.args=[]),this.ctx||(this.ctx=this),b.isNum(this.delay)||(this.delay=d),b.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:e,buffer:d,count:0,delay:d,times:0,disable:function(){this.disabled=e,this[j]=b.noop},enable:function(){this.disabled=c,this[j]=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var a=Array.from(arguments),c=this.ctx,e=this.delay,f=b.type(a[0]),g;return f&&(f.endsWith("event")||f=="n8iv_observer")?a.splice.apply(a,[1,0].concat(this.args)):a.unshift.apply(a,this.args),e===d?g=this.fn.apply(c,a):this.fn.delay.apply(this.fn,[e,c].concat(a)),g},reset:function(){this.count=0,f.call(this.enable())}}}()),b.Class("n8iv.Hash",function(){var a="__hashid__",e=[];return{constructor:function(d){b.def(this,a,b.describe(e.push(b.obj())-1,h)),!b.isObj(d)||this.set(d)},keys:{get:function(){return Object.keys(e[this[a]])}},length:{get:function(){return this.keys[l]}},values:{get:function(){return Object.values(e[this[a]])}},aggregate:function(b,c,d){var f=this,g=e[this[a]];return d||(d=f),Object.keys(g).reduce(function(a,b,e){return c.call(d,a,g[b],b,f,e)},b)},clear:function(){e[this[a]]=b.obj()},clone:function(){return new b.Hash(Object.clone(e[this[a]]))},each:function(b,c){var d=this,f=e[this[a]];return c||(c=d),Object.keys(f).forEach(function(a,e){b.call(c,f[a],a,d,e)},d),d},get:function(c){return b.has(e[this[a]],c)?e[this[a]][c]:d},has:function(c){return b.has(e[this[a]],c)},key:function(b){return Object.key(e[this[a]],b)},reduce:function(b,c){var d=this,f=e[this[a]];return Object.keys(f).reduce(function(a,c,e){return b.call(d,a,f[c],c,d,e)},c)},remove:function(d){return b.has(e[this[a]],d)?delete e[this[a]][d]:c},set:function(c,d){switch(b.type(c)){case m:case n:Object.keys(c).forEach(function(a){this.set(a,c[a])},this);break;default:e[this[a]][c]=d}},stringify:function(){return JSON.stringify(e[this[a]])},toString:function(){return b.tostr(e[this[a]])},valueOf:function(){return Object.clone(e[this[a]])}}}()),b.Class("n8iv.Observer",function(){function a(a){a=Object.clone(a);var c=a[t],d,e,f,g=a[x],h;Object.remove(a,t,x);for(d in a){e=a[d],f=b.isUndef(e[x])?g:e[x],h=b.isUndef(e[t])?c:e[t];switch(b.type(e)){case k:this.on(d,e,c,g);break;case m:case n:switch(b.type(e[v])){case k:case m:case n:this.on(d,e[v],h,f);break;case i:e[v].forEach(function(a){this.on(d,a,h,f)},this)}break;case i:e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function f(a){var d=this.args.concat(a[x].args),f=a[t]||this[t],g=a.fire||a[v];return b.isFn(g)?(Object.key(this[t],a[v])?d[0]!==this[t]||d.shift():d[0]!==this[t]&&d.unshift(this[t]),g.apply(f,d)!==c):e}function g(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),r.apply(b,e)}}function h(a,b){var c=this;return b.fire=function(){c.un(a,b[v],b[t]);if(b.fired)return;return b.fired=e,b[v].apply(b[t]||c,arguments)}}function j(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function o(a,c,f){a=a.lc();var g=this[w].get(a),h,i;if(!g)return;switch(b.type(c)){case"n8iv_callback":i={ctx:c,isCB:e};break;default:i={ctx:f||this,fn:c}}i.event=a,i=g.find(p,i),i!==d&&(h=g.indexOf(i),h<0||g.splice(h,1))}function p(a){return(this.isCB===e?a[v].valueOf()===this[t].fire:a[v]===this[v])&&a[t]===this[t]&&a.event===this.event}function q(c,d,e,f){var g,k=this[w],l,o;if(b.isObj(c))return a.call(this,c);switch(l=b.nativeType(d)){case i:return g=b.obj(),g[c]={fn:d,options:f,ctx:e},a.call(this,g);case m:case n:case"n8iv_callback":"handleEvent"in d&&(!b.isObj(e)||!b.isUndef(f)||(f=e),e=d,d=j(d));break;case"string":!e||(d=e[d])}c=c.lc(),(o=k.get(c))||k.set(c,o=[]);switch(b.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case m:case n:f=Object.clone(f);break;default:f=b.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:e||this,event:c,fn:d,id:++z,options:f},g.fire=(f.single?h.call(this,c,g):g[v]).callback({args:f.args,buffer:f.buffer,ctx:g[t],delay:f.delay}),o.push(g)}function r(){return this.broadcast.apply(this,arguments)}var s="broadcasting",t="ctx",u="destroyed",v="fn",w="listeners",x="options",y="observer_suspended",z=0;return{constructor:function(d){this[s]=c,this[u]=c,this[y]=c,this[w]=b.Hash.create(),!b.isObj(d)||this.on(d),!b.isObj(this.observers)||this.on(this.observers),delete this.observers},broadcast:function(a){if(this[u]||this[y]||!this[w][l]||!a||!this[w].has(a=a.lc()))return;var b=Array.from(arguments,1),d=this[w].get(a).clone();if(!d[l])return;this[s]=a,d.every(f,{args:b,ctx:this}),this[s]=c},buffer:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.buffer=Number.toInteger(a),this.on(c,d,e,f)},delay:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.delay=Number.toInteger(a),this.on(c,d,e,f)},destroy:function(){return this[u]?e:this.broadcast("before:destroy")===c?c:(this[u]=e,this._destroy(),this.broadcast("destroy"),this[y]=e,delete this[w],e)},ignore:o,observe:q,on:q,once:function(a,c,d,f){b.isObj(f)||(f=b.obj()),f.single=e,this.on(a,c,d,f)},purgeObservers:function(a){var b=this[w];if(!a){b.clear();return}a=a.lc(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,g(this,a,c),a)},resumeEvents:function(){!this[y]||(this[y]=c,this.broadcast("observer:resumed"))},suspendEvents:function(){this[y]||(this[y]=e,this.broadcast("observer:suspended"))},un:o,_destroy:b.noop}}()),b.ENV!="commonjs"||(module.exports=b)}(this,typeof n8iv=="undefined"?this.document?this.n8iv:require("./n8iv._"):n8iv)
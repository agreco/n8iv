!function(a){"use strict";var b=!1,c=null,d=!0,e;!function(){function f(b,c){!c&&a.isObj(b)&&(c=b,b="");var e,f,l,n,o=a.obj(),p=c.extend||Object,q=c.module,s=c.mixin||t,u=c.singleton,y=k(c.type||b);return!a.isStr(p)||(p=w[p]||x[p]),n=c.constructor!==Object?c.constructor:p,b&&(l=b.split("."),f=l.pop(),l=a.bless(l,q)),a.def(o,"parent",a.describe(a.noop,"cw"),d),a.def(o,"constructor",a.describe(i(n,p,f,o),"w"),d),e=o.constructor,a.def(e,"__type__",a.describe("class","w"),d),a.def(o,"__type__",a.describe(y,"w"),d),Object.remove(c,r),e.prototype=g(o,a.copy(c,s)),a.def(e,"create",a.describe(h(j(e,p)),"w"),d),b=b.replace(v,""),u?(a.def(e,"singleton",a.describe({value:u===d?new e:e.create.apply(e,[].concat(u))},"w")),m(e,b,y),e=e.singleton):b&&m(e,b,y),!f||!l||a.def(l,f,a.describe({value:e},"w")),e}function g(b,c){return Object.each(c,function(c,e){switch(a.type(c)){case"object":a.def(b,e,c,d);break;default:b[e]=c}}),b}function h(a){return function(){return n(a)||a.apply(Object.create(a.prototype),arguments)}}function i(a,b,d,f){var g=p(a,b,d),h=function(){var a=this===e?c:this,b=a?a.constructor:c;return n(b)||g.apply(l(a,h)?a:Object.create(f),arguments)};return h.mimic(a,d)}function j(b,c){if(!("__super"in b.prototype)){var e=b.prototype,f=c.prototype;Object.keys(f).forEach(function(b){if(b in y)return;switch(a.type(f[b])){case"function":e[b]=a.isFn(e[b])?p(e[b],f[b],b):p(f[b],a.noop,b);break;default:b in e||a.def(e,b,a.description(f,b),d)}}),Object.keys(e).forEach(function(b){!a.isFn(e[b])||b in f&&e[b].valueOf()===f[b].valueOf()||(e[b]=p(e[b],a.noop,b))}),f=a.describe({value:Object.create(c.prototype)},"w"),a.def(b,"__super",f),a.def(b.prototype,"__super",f)}return b}function k(a){return a.replace(v,"").replace(u,"_").toLowerCase()}function l(a,c){if(a&&c){if(a instanceof c)return d;if(!(a=a.constructor))return b;do if(a===c)return d;while(a.__super&&(a=a.__super.constructor))}return b}function m(b,c,e){var f=c+q,g=[];!c||!(c in w)||g.push(f+"Class"),!e||!(e in x)||g.push(f+"Type"),g.length&&(a.trace(),g.forEach(a.error),a.error(new Error("n8iv.Class overwrite error."),d)),w[c]=x[e]=b}function n(a){return a?a.singleton||c:c}function o(a){var b=a.constructor,d;for(d in w)if(w[d]===b)return d;return c}function p(c,f,g){return function(){var g,h=a.description(this,"parent")||s;return h.writable=d,a.def(this,"parent",f?a.describe(f,"cw"):s,d),g=c.apply(this,arguments),a.def(this,"parent",h,d),this.chain!==b&&g===e?this:g}.mimic(c,g)}var q=" already exists. Cannot override existing ",r="constructor extend mixin module singleton type".split(" "),s=a.describe(a.noop,"cw"),t=a.obj(),u=/\./g,v=/^\u005E/,w=a.obj(),x=a.obj(),y=a.obj();y.constructor=y.parent=y.__super=y.__type__=d,a.def(f,"is",a.describe(l,"w")).def(f,"type",a.describe(o,"w")).def(a,"Class",a.describe(f,"w")).def(a,"create",a.describe(function(b){var c=x[b]||x["n8iv_"+b]||w[b],e=Array.from(arguments,1);return c||a.trace().error(new Error(b+" does not match any registered n8iv.Classes."),d),c.create.apply(a.global,e)},"w"))}(),a.Class("n8iv.Callback",function(){function e(){return h in this?this:(this[h]=setTimeout(f.bind(this),this.buffer),this.exec.apply(this,arguments))}function f(){clearTimeout(this[h]),delete this[h]}function g(){return this.fire.apply(this,arguments)}a.def(Function.prototype,"callback",a.describe(function(b){return(new a.Callback(this,b)).fire.mimic(this)},"w"));var h="bufferId",i="handleEvent",j="timeoutId";return{constructor:function(d,f){a.copy(this,f||a.obj());var g=a.describe(c,"w"),h=(a.isNum(this.buffer)?e:this.exec).bind(this);g.value=d,a.def(this,"fn",g),g.value=this,a.def(h,"cb",g),g.value=h,a.def(this,"fire",g),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.isNum(this.delay)||(this.delay=c),a.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:d,buffer:c,count:0,delay:c,times:0,disable:function(){this.disabled=d,this[i]=a.noop},enable:function(){this.disabled=b,this[i]=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var b=Array.from(arguments),d=this,e=d.ctx,f=d.delay,g=a.type(b[0]),h;return g&&(g.endsWith("event")||g=="n8iv_observer")?b.splice.apply(b,[1,0].concat(d.args)):b.unshift.apply(b,d.args),f===c?h=d.fn.apply(e,b):this[j]=setTimeout(function(){d.fn.apply(e,b)},f),h},reset:function(){this.count=0,f.call(this.enable())},stop:function(){!(j in this)||clearTimeout(this[j]),delete this[j]}}}()),a.Class("n8iv.Hash",function(){var d="__hashid__",e=[];return{constructor:function(c){a.def(this,d,a.describe(e.push(a.obj())-1,"w")),!a.isObj(c)||this.set(c)},keys:{get:function(){return Object.keys(e[this[d]])}},length:{get:function(){return this.keys.length}},values:{get:function(){return Object.values(e[this[d]])}},aggregate:function(a,b,c){var f=this,g=e[this[d]];return c||(c=f),Object.keys(g).reduce(function(a,d,e){return b.call(c,a,g[d],d,f,e)},a)},clear:function(){e[this[d]]=a.obj()},clone:function(){return new a.Hash(Object.clone(e[this[d]]))},each:function(a,b){var c=this,f=e[this[d]];return b||(b=c),Object.keys(f).forEach(function(d,e){a.call(b,f[d],d,c,e)},c),c},get:function(b){return a.has(e[this[d]],b)?e[this[d]][b]:c},has:function(b){return a.has(e[this[d]],b)},key:function(a){return Object.key(e[this[d]],a)},reduce:function(a,b){var c=this,f=e[this[d]];return Object.keys(f).reduce(function(b,d,e){return a.call(c,b,f[d],d,c,e)},b)},remove:function(c){return a.has(e[this[d]],c)?delete e[this[d]][c]:b},set:function(b,c){switch(a.type(b)){case"object":case"nullobject":Object.keys(b).forEach(function(a){this.set(a,b[a])},this);break;default:e[this[d]][b]=c}},stringify:function(){return JSON.stringify(e[this[d]])},toString:function(){return a.tostr(e[this[d]])},valueOf:function(){return Object.clone(e[this[d]])}}}()),a.Class("n8iv.Observer",function(){function e(b){b=Object.clone(b);var c=b[o],d,e,f,g=b[s],h;Object.remove(b,o,s);for(d in b){e=b[d],f=a.isUndef(e[s])?g:e[s],h=a.isUndef(e[o])?c:e[o];switch(a.type(e)){case"function":this.on(d,e,c,g);break;case"object":case"nullobject":switch(a.type(e[q])){case"function":case"object":case"nullobject":this.on(d,e[q],h,f);break;case"array":e[q].forEach(function(a){this.on(d,a,h,f)},this)}break;case"array":e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function f(c){var e=this.args.concat(c[s].args),f=c[o]||this[o],g=c.fire||c[q];return a.isFn(g)?(Object.key(this[o],c[q])?e[0]!==this[o]||e.shift():e[0]!==this[o]&&e.unshift(this[o]),g.apply(f,e)!==b):d}function g(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),m.apply(b,e)}}function h(a,b){var c=this;return b.fire=function(){c.un(a,b[q],b[o]);if(b.fired)return;return b.fired=d,b[q].apply(b[o]||c,arguments)}}function i(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function j(b,e,f){b=b.toLowerCase();var g=this[r].get(b),h,i;if(!g)return;switch(a.type(e)){case"n8iv_callback":i={ctx:e,isCB:d};break;default:i={ctx:f||this,fn:e}}i.event=b,i=g.find(k,i),i!==c&&(h=g.indexOf(i),h<0||g.splice(h,1))}function k(a){return(this.isCB===d?a[q].valueOf()===this[o].fire:a[q]===this[q])&&a[o]===this[o]&&a.event===this.event}function l(b,c,d,f){var g,j=this[r],k,l;if(a.isObj(b))return e.call(this,b);switch(k=a.nativeType(c)){case"array":return g=a.obj(),g[b]={fn:c,options:f,ctx:d},e.call(this,g);case"object":case"nullobject":case"n8iv_callback":"handleEvent"in c&&(!a.isObj(d)||!a.isUndef(f)||(f=d),d=c,c=i(c));break;case"string":!d||(c=d[c])}b=b.toLowerCase(),(l=j.get(b))||j.set(b,l=[]);switch(a.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case"object":case"nullobject":f=Object.clone(f);break;default:f=a.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:d||this,event:b,fn:c,id:++u,options:f},g.fire=(f.single?h.call(this,b,g):g[q]).callback({args:f.args,buffer:f.buffer,ctx:g[o],delay:f.delay}),l.push(g)}function m(){return this.broadcast.apply(this,arguments)}var n="broadcasting",o="ctx",p="destroyed",q="fn",r="listeners",s="options",t="observer_suspended",u=0;return{constructor:function(d){this[n]=b,this[p]=b,this[t]=b,this[r]=a.Hash.create(),!a.isObj(d)||this.on(d),!a.isObj(this.observers)||this.on(this.observers),delete this.observers},broadcast:function(a){if(this[p]||this[t]||!this[r].length||!a||!this[r].has(a=a.toLowerCase()))return;var c=Array.from(arguments,1),d=this[r].get(a).slice();if(!d.length)return;this[n]=a,d.every(f,{args:c,ctx:this}),this[n]=b},buffer:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.buffer=Number.toInteger(b),this.on(c,d,e,f)},delay:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.delay=Number.toInteger(b),this.on(c,d,e,f)},destroy:function(){return this[p]?d:this.broadcast("before:destroy")===b?b:(this[p]=d,this._destroy(),this.broadcast("destroy"),this[t]=d,delete this[r],d)},ignore:j,observe:l,on:l,once:function(b,c,e,f){a.isObj(f)||(f=a.obj()),f.single=d,this.on(b,c,e,f)},purgeObservers:function(a){var b=this[r];if(!a){b.clear();return}a=a.toLowerCase(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,g(this,a,c),a)},resumeEvents:function(){!this[t]||(this[t]=b,this.broadcast("observer:resumed"))},suspendEvents:function(){this[t]||(this[t]=d,this.broadcast("observer:suspended"))},un:j,_destroy:a.noop}}()),a.ENV!="commonjs"||module.exports===a||(module.exports=a)}(typeof n8iv!="undefined"?n8iv:typeof require!="undefined"?require("./n8iv._"):null)
!function(a,b){var c=!1,d=null,e=!0,f,g="cw",h="r",i="array",j="constructor",k="function",l="length",m="object",n=d+m,o="prototype",p="__type__";!function(){function i(a,c){!c&&b.isObj(a)&&(c=a,a="");var f,i,k,l=c[j],m=b.obj(),u=c.extend||Object,w=c.module,x=c.mixin||E,y=c.singleton,z=(c.type||a).replace(G,"_").lc();return!b.isStr(u)||(u=H[u]||I[u]),a&&(k=a.split("."),i=k.pop(),k=b.bless(k,w?w.exports||(w.exports=b.obj()):d)),b.def(m,A,b.describe(b.noop,g),e),b.def(m,j,b.describe(s(l,u[o][j],i,m),h),e),f=m[j],b.def(f,p,b.describe("class",h),e),b.def(m,p,b.describe(z,h),e),Object.remove(c,C),f[o]=n(m,b.copy(c,x)),b.def(f,"create",b.describe(q(t(f,u)),h),e),y?(b.def(f,"singleton",b.describe({value:y===e?new f:f.create.apply(f,[].concat(y))},h)),v(f,a,z),f=f.singleton):a&&v(f,a,z),!i||!k||b.def(k,i,b.describe({value:f},h)),f}function n(a,c){return Object.each(c,function(c,d){switch(b.type(c)){case m:b.def(a,d,c,e);break;default:a[d]=c}}),a}function q(a){return function(){return w(a)||a.apply(Object.create(a[o]),arguments)}}function s(a,b,c,d){var e=y(a,b,c),f=function(){return w(this.constructor)||e.apply(u(this,f)?this:Object.create(d),arguments)};return f.mimic(a,c)}function t(a,c){if(!(B in a[o])){var d=a[o],f=c[o];Object.keys(f).forEach(function(a){if(a in J)return;switch(b.type(f[a])){case k:d[a]=b.isFn(d[a])?y(d[a],f[a],a):y(f[a],b.noop,a);break;default:a in d||b.def(d,a,b.description(f,a),e)}}),Object.keys(d).forEach(function(a){!b.isFn(d[a])||a in f&&d[a].valueOf()===f[a].valueOf()||(d[a]=y(d[a],b.noop,a))}),f=b.describe({value:Object.create(c[o])},h),b.def(a,B,f),b.def(a[o],B,f)}return a}function u(a,b){if(a instanceof b)return e;if(!(a=a[j]))return c;do if(a===b)return e;while(a[B]&&(a=a[B][j]));return c}function v(a,c,d){var f=c+z,g=[];!c||!(c in H)||g.push(f+"Class"),!d||!(d in I)||g.push(f+"Type"),g[l]&&(b.trace(),g.forEach(b.error),b.error(new Error("n8iv.Class overwrite error."),e)),H[c]=I[d]=a}function w(a){return a?a.singleton||d:d}function x(a){var b=a[j],c;for(c in H)if(H[c]===b)return c;return d}function y(a,d,h){return function(){var h,i=b.description(this,A)||D;return i.writable=e,b.def(this,A,d?b.describe(d,g):D,e),h=a.apply(this,arguments),b.def(this,A,i,e),this.chain!==c&&h===f?this:h}.mimic(a,h)}var z="{0} already exists. Cannot override existing {1}",A="parent",B="__super",C=(j+" extend mixin module singleton type").split(" "),D=b.describe(b.noop,g),E=b.obj(),G=/\./g,H=b.obj(),I=b.obj(),J=b.obj();J[j]=J[A]=J[B]=J[p]=e,b.def(i,"is",b.describe(u,h)),b.def(i,"type",b.describe(x,h)),b.def(b,"Class",b.describe(i,h)),b.def(b,"create",b.describe(function(c){var d=I[c]||I["n8iv_"+c]||H[c],f=Array.from(arguments,1);return d||b.trace().error(new Error(c+" does not match any registered n8iv.Classes."),e),d.create.apply(a,f)},h))}(),b.Class("n8iv.Callback",function(){function a(){return i in this?this:(this[i]=setTimeout(f.bind(this),this.buffer),this.exec.apply(this,arguments))}function f(){clearTimeout(this[i]),delete this[i]}function g(){return this.fire.apply(this,arguments)}b.def(Function[o],"callback",b.describe(function(a){return(new b.Callback(this,a)).fire.mimic(this)},h));var i="bufferId",j="handleEvent";return{constructor:function(e,f){b.copy(this,f||b.obj());var g=b.describe(d,h),i=(b.isNum(this.buffer)?a:this.exec).bind(this);g.value=e,b.def(this,"fn",g),g.value=this,b.def(i,"cb",g),g.value=i,b.def(this,"fire",g),this.args||(this.args=[]),this.ctx||(this.ctx=this),b.isNum(this.delay)||(this.delay=d),b.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:e,buffer:d,count:0,delay:d,times:0,disable:function(){this.disabled=e,this[j]=b.noop},enable:function(){this.disabled=c,this[j]=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var a=Array.from(arguments),c=this.ctx,e=this.delay,f=b.type(a[0]),g;return f&&(f.endsWith("event")||f=="n8iv_observer")?a.splice.apply(a,[1,0].concat(this.args)):a.unshift.apply(a,this.args),e===d?g=this.fn.apply(c,a):this.fn.delay.apply(this.fn,[e,c].concat(a)),g},reset:function(){this.count=0,f.call(this.enable())}}}()),b.Class("n8iv.Hash",function(){var a="__hashid__",e=[];return{constructor:function(d){b.def(this,a,b.describe(e.push(b.obj())-1,h)),!b.isObj(d)||this.set(d)},keys:{get:function(){return Object.keys(e[this[a]])}},length:{get:function(){return this.keys[l]}},values:{get:function(){return Object.values(e[this[a]])}},aggregate:function(b,c,d){var f=this,g=e[this[a]];return d||(d=f),Object.keys(g).reduce(function(a,b,e){return c.call(d,a,g[b],b,f,e)},b)},clear:function(){e[this[a]]=b.obj()},clone:function(){return new b.Hash(Object.clone(e[this[a]]))},each:function(b,c){var d=this,f=e[this[a]];return c||(c=d),Object.keys(f).forEach(function(a,e){b.call(c,f[a],a,d,e)},d),d},get:function(c){return b.has(e[this[a]],c)?e[this[a]][c]:d},has:function(c){return b.has(e[this[a]],c)},key:function(b){return Object.key(e[this[a]],b)},reduce:function(b,c){var d=this,f=e[this[a]];return Object.keys(f).reduce(function(a,c,e){return b.call(d,a,f[c],c,d,e)},c)},remove:function(d){return b.has(e[this[a]],d)?delete e[this[a]][d]:c},set:function(c,d){switch(b.type(c)){case m:case n:Object.keys(c).forEach(function(a){this.set(a,c[a])},this);break;default:e[this[a]][c]=d}},stringify:function(){return JSON.stringify(e[this[a]])},toString:function(){return b.tostr(e[this[a]])},valueOf:function(){return Object.clone(e[this[a]])}}}()),b.Class("n8iv.Observer",function(){function a(a){a=Object.clone(a);var c=a[r],d,e,f,g=a[v],h;Object.remove(a,r,v);for(d in a){e=a[d],f=b.isUndef(e[v])?g:e[v],h=b.isUndef(e[r])?c:e[r];switch(b.type(e)){case k:this.on(d,e,c,g);break;case m:case n:switch(b.type(e[u])){case k:case m:case n:this.on(d,e[u],h,f);break;case i:e[u].forEach(function(a){this.on(d,a,h,f)},this)}break;case i:e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function f(a){var d=this.args.concat(a[v].args),f=a[r]||this[r],g=a.fire||a[u];return b.isFn(g)?(Object.key(this[r],a[u])?d[0]!==this[r]||d.shift():d[0]!==this[r]&&d.unshift(this[r]),g.apply(f,d)!==c):e}function g(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),p.apply(b,e)}}function h(a,b){var c=this;return b.fire=function(){c.un(a,b[u],b[r]);if(b.fired)return;return b.fired=e,b[u].apply(b[r]||c,arguments)}}function j(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function o(a){return(this.isCB===e?a[u].valueOf()===this[r].fire:a[u]===this[u])&&a[r]===this[r]&&a.event===this.event}function p(){return this.broadcast.apply(this,arguments)}var q="broadcasting",r="ctx",s="destroyed",t="events",u="fn",v="options",w="events_suspended",x=0;return{constructor:function(d){this[q]=c,this[s]=c,this[w]=c,this[t]=b.Hash.create(),!b.isObj(d)||this.on(d)},broadcast:function(a){if(this[s]||this[w]||!this[t][l]||!a||!this[t].has(a=a.lc()))return;var b=Array.from(arguments,1),d=this[t].get(a).clone();if(!d[l])return;this[q]=a,d.every(f,{args:b,ctx:this}),this[q]=c},buffer:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.buffer=Number.toInteger(a),this.on(c,d,e,f)},delay:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.delay=Number.toInteger(a),this.on(c,d,e,f)},destroy:function(){return this[s]?e:this.broadcast("before:destroy")===c?c:(this[s]=e,this._destroy(),this.broadcast("destroy"),this[w]=e,delete this[t],e)},on:function(c,d,e,f){var g,k=this[t],l,o;if(b.isObj(c))return a.call(this,c);switch(l=b.nativeType(d)){case i:return g=b.obj(),g[c]={fn:d,options:f,ctx:e},a.call(this,g);case m:case n:case"n8iv_callback":"handleEvent"in d&&(!b.isObj(e)||!b.isUndef(f)||(f=e),e=d,d=j(d));break;case"string":!e||(d=e[d])}c=c.lc(),(o=k.get(c))||k.set(c,o=[]);switch(b.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case m:case n:f=Object.clone(f);break;default:f=b.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:e||this,event:c,fn:d,id:++x,options:f},g.fire=(f.single?h.call(this,c,g):g[u]).callback({args:f.args,buffer:f.buffer,ctx:g[r],delay:f.delay}),o.push(g)},once:function(a,c,d,f){b.isObj(f)||(f=b.obj()),f.single=e,this.on(a,c,d,f)},purgeObservers:function(a){var b=this[t];if(!a){b.clear();return}a=a.lc(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,g(this,a,c),a)},resumeEvents:function(){!this[w]||(this[w]=c,this.broadcast("observer:resumed"))},suspendEvents:function(){this[w]||(this[w]=e,this.broadcast("observer:suspended"))},un:function(a,c,f){a=a.lc();var g=this[t].get(a),h,i;if(!g)return;switch(b.type(c)){case"n8iv_callback":i={ctx:c,isCB:e};break;default:i={ctx:f||this,fn:c}}i.event=a,i=g.find(o,i),i!==d&&(h=g.indexOf(i),h<0||g.splice(h,1))},_destroy:b.noop}}())}(this,this.n8iv)
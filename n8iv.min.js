!function(a){function b(a,b,c){return m(a,U)?bp.call(a,G(b)?b>0?b:0:0,G(c)?c>b?c:b+1:a[U]):[a]}function c(b,c){switch(B(b)){case O:break;case Z:b=b.split(".");break;default:return c||bb!=Q?a:module.exports}return c||(c=bb!=Q?a:module.exports),b[0]!="n8iv"||(c=n8iv,b.shift()),b.forEach(function(a){if(!a)return;m(c,a)||(c[a]=r()),c=c[a]}),c}function d(a){switch(B(a)){case K:return K;case P:return a;case V:return a!==0&&!isNaN(a);case Z:return!bc.some(function(b){return b===a});default:return a===N||a===L?K:M}}function e(a,b,c){return isNaN(b=Number(a))?(c=String(a))in bd?bd[c]:a:b}function f(a,b,c){c=c===M;for(var d in b)!n(b,d)||c&&n(a,d)||(a[d]=b[d]);return a}function g(a,b,c,d,e){var f=m(a,b);return!c.get&&!c.set||delete c.writable,d===M||!f?Object.defineProperty(a,b,c):e===M&&f&&x().error(new Error("Trying to overwrite existing property: "+b+", in: "+(F(a)?a.n8ivName:a[R].n8ivName)+"."),M),n8iv}function h(a,b,c,d,e){c||(c=bf);for(var f in b)!n(b,f)||g(a,f,i(b[f],c),d,e);return n8iv}function i(a,b){return f(H(a,M)?a:{value:a},H(b)?b:bj[o(b)]||bj.cew)}function j(a,b){return Object.getOwnPropertyDescriptor(a,b)}function k(a,b){var c;switch(B(a)){case S:c=a.message;break;case Z:c=String(a),a=new Error(a)}!(S in console)||console.error(c);if(b===M)throw a;return n8iv}function l(a){return a!==L&&a!==N&&(typeof a==V?!isNaN(a):M)}function m(a,b){return b in Object(a)}function n(a,b){return ba.hasOwnProperty.call(a,b)}function o(a){return String(a).toLowerCase()}function p(a,b){return a?m(a,"id")?a.id:a.id=q(b):q(b)}function q(a){return(a||bi)+ ++bh}function r(a,b){return(b=Object.create(L))&&arguments[U]>=1?f(b,a):b}function s(a){return Object.getPrototypeOf(a)}function t(){}function u(a,b){var c=[a];while(++a<=b)c.push(a);return c}function v(a){return a}function w(a){return ba.toString.call(a)}function x(){return!("trace"in console)||console.trace(),n8iv}function y(a){return ba.valueOf.call(a)}function z(){var a=this[R],b=C(this),c=bb!=Q?A(b):bm.test(b)?"global":K;return c||(b==W&&a[$]!=T?a[$]||o(a.n8ivName)||b:b)}function A(a){return bk.test(a)?"htmlcollection":bl.test(a)?"htmlelement":bm.test(a)?"global":K}function B(a){return a===L||a===N?K:a[$]||(s(a)===L?X:N)}function C(a,b){return(b=w(a))in bq?bq[b]:bq[b]=o(b).match(bn)[1].replace(bo,"$1")}function D(a){return B(a)==P}function E(a){switch(B(a)){case O:return!a[U];case V:return isNaN(a);case W:return!Object.len(a);case Z:return a==="";default:return!l(a)}}function F(a){return typeof a==T}function G(a){return B(a)==V&&!isNaN(a)}function H(a,b){var c=B(a);return c==W&&C(a)==W||b!==M&&c==X}function I(a){return B(a)==Z}function J(a){return typeof a==_}var K=!1,L=null,M=!0,N,O="array",P="boolean",Q="commonjs",R="constructor",S="error",T="function",U="length",V="number",W="object",X=L+W,Y="prototype",Z="string",$="__type__",_=""+N,ba=Object[Y],bb=typeof module!=_&&"exports"in module?Q:typeof navigator!=_?"ua":"other",bc=[0,K,"",NaN,L,N].map(String),bd=[K,NaN,L,M,N].reduce(function(a,b){return a[String(b)]=b,a},r()),be="c",bf="cw",bg="r",bh=999,bi="anon__",bj=function(){var a="configurable enumerable writable".split(" "),b={ce:"ec",cw:"wc",ew:"we",cew:"cwe ecw ewc wce wec".split(" ")},c={c:[M,K,K],ce:[M,M,K],cew:[M,M,M],cw:[M,K,M],e:[K,M,K],ew:[K,M,M],r:[K,K,K],w:[K,K,M]};return Object.keys(c).reduce(function(d,e){return d[e]=a.reduce(function(a,b,d){return a[b]=c[e][d],a},r()),e in b&&typeof b[e]!=Z?b[e].forEach(function(a){d[a]=d[e]}):d[b[e]]=d[e],d},r())}(),bk=/htmlcollection|nodelist/,bl=/^html\w+?element$/,bm=/domprototype|global|window/i,bn=/\[[^\s]+\s([^\]]+)\]/,bo=/^[Ww]ebkit|[Mm]oz|O|[Mm]s|[Kk]html(.*)$/,bp=Array[Y].slice,bq={"[object Object]":W};n8iv=r(),g(ba,$,f({get:z},bj.r)),g(Array,"from",i(b,bg)),h(Object,{clone:function(a){return f(r(),a)},each:function(a,b,c){return c||(c=a),Object.keys(a).forEach(function(d,e){b.call(c,a[d],d,a,e)},a),a},key:function(a,b){for(var c in a)if(a[c]===b)return c;return L},len:function(a){return Object.keys(a)[U]},remove:function(a,c){return(Array.isArray(c)?c:b(arguments,1)).forEach(function(b){delete a[b]}),a},value:function(a,b){if(isNaN(b)&&b.indexOf(".")>-1){var c;b=b.split(".");while(c=b.shift()){a=Object.value(a,c);if(a===N)return a}return a}return E(a)?N:E(a[b])?F(a.get)?a.get(b):F(a.getAttribute)?a.getAttribute(b):N:a[b]},values:function(a){return Object.keys(a).map(function(b){return a[b]})}},bg),g(Array[Y],"find",i(function(a,b){var c=-1,d=this[U]>>>0;b||(b=this);while(++c<d)if(!!a.call(b,this[c],c,this))return this[c];return L},bg)),h(Function[Y],{n8ivName:{get:function(){var a="anonymous",b=["",""],c="__n8ivName__",d=/[\s\(]*function([^\(]+).*/;return function(){if(!this[c]){var f=this.valueOf(),h=f!==this?f.n8ivName!==a?f.n8ivName:L:L,j=this.name||this.displayName||(String(this).match(d)||b)[1].trim();g(this,c,i(h||j||a,"w"))}return this[c]}}()},bind:function(c){var d=b(arguments,1),e=function(){return f.apply(this instanceof e?this:c||a,d.concat(b(arguments)))},f=this;return e[Y]=Object.create(f[Y]),e.mimic(f)},mimic:function(a,b){return Object.defineProperties(this,{displayName:i(b||a.n8ivName,be),toString:i(function(){return a.valueOf().toString()},be),valueOf:i(function(){return a},be)})}},bg),h(String[Y],{endsWith:function(a){return this[U]&&this.lastIndexOf(a)==this[U]-a[U]},lc:function(){return o(this)},startsWith:function(a){return!this.indexOf(a)}},bg),typeof global==_||(a=global);try{bb!=Q?g(a,"n8iv",i({value:n8iv},bg)):module.exports=n8iv}catch(br){}h(n8iv,{ENV:bb,modes:bj,global:{value:a},bless:c,bool:d,coerce:e,copy:f,def:g,defs:h,describe:i,description:j,error:k,exists:l,got:m,has:n,id:p,isBool:D,isEmpty:E,isFn:F,isNum:G,isObj:H,isStr:I,isUndef:J,nativeType:C,noop:t,obj:r,proto:s,range:u,requite:v,tostr:w,trace:x,type:B,valof:y},bg)}(this),!function(a,b){function i(a,b,c,d){return d||(d=a),Object.keys(a).reduce(function(b,e,f){return c.call(d,b,a[e],e,a,f)},b)}function j(a){return Object.keys(a).forEach(function(b){delete a[b]},a),a}function k(a,c){switch(b.type(a)){case"array":return Array.isArray(c)?l(a,c):e;case"object":return b.isObj(c)?m(a,c):e;case"date":return+a==+c}return a==c}function l(a,b){return a[c]==b[c]&&Array.from(a).every(function(a,c){return k(b[c],a)})}function m(a,c){if(Object.len(a)!==Object.len(c)||o(a)!==o(c))return e;for(var d in c)if(b.has(a,d)!==b.has(c,d)||!k(a[d],c[d]))return e;return g}function n(a){return Object.getOwnPropertyNames(a)}function o(a){return n(a)[c]}function p(a,b,c){return Object.keys(a).reduce(function(c,d,e){return b.call(a,c,a[d],d,a,e)},c)}var c="length",d="prototype",e=!1,f=null,g=!0,h="r";b.defs(Object,{aggregate:i,clear:j,equalTo:k,ownKeys:n,ownLen:o,reduce:p},h),b.defs(Function[d],function(){var a=/^[\s\(]*function[^\(]*\(([^\)]*)\)/,d=/\s*,\s*/;return b.def(Function,"from",b.describe(function(c){return b.isFn(c)?c:function(){return c}},h)),{params:{get:function(){var b=String(this).match(a)[1].trim().split(d);return b[c]==1&&!b[0]?[]:b}},attempt:function(a){var b=Array.from(arguments,1),c=this;return function(){try{return c.apply(a||this,b)}catch(e){return e}}()},bake:function(){var a="baked",c=this;return c[a]||!b.def(c,a,b.describe(function(){return c.apply(this,[this].concat(Array.from(arguments)))}.mimic(c),h))||c[a]},defer:b.ENV=="commonjs"?function(a){return process.nextTick(this.bind.apply(this,[a].concat(Array.from(arguments,1))))}:function(){return this.delay.apply(this,[1].concat(Array.from(arguments)))},delay:function(a,c){function f(){return f.stop(),e.apply(c||this,d)}var d=Array.from(arguments,2),e=this;return b.copy(f,{stop:function(){return clearTimeout(this.timeoutId),delete this.timeoutId,e},timeoutId:setTimeout(f,a)})},memoize:function(a){function d(){var b=Array.from(arguments),d=b.toString();return d in a?a[d]:a[d]=c.apply(this,b)}var c=this;return b.isObj(a)||(a=b.obj()),d.unmemoize=function(){return c},d},stop:function(){return this},unmemoize:function(){return this},wrap:function(a){var b=Array.from(arguments,1),c=this;return function(){return a.apply(this,[c.bind(this)].concat(b).concat(Array.from(arguments)))}.mimic(a)}}}(),h),b.defs(Array[d],function(){function a(a,b){return a(b)?0:1}function e(a,b){return a.test(b)?0:1}function i(a,b){return Object.value(b,a)||1}function j(a){return a?a:f}function k(a){return a[0]}function l(a){return[a,b.isFn(this)?this(a):Object.value(a,this)]}var m=Array[d],n={desc:function(a,b){return a[1]==b[1]?0:a[1]<b[1]?1:-1},asc:function(a,b){return a[1]==b[1]?0:a[1]>b[1]?1:-1}};return n[String(g)]=n[1]=n.asc,n[String(!1)]=n[0]=n.desc,b.def(Array,"sortFns",b.describe({value:n},h)),{aggregate:function(a,b,c){return m.reduce.call(this,function(a,d,e,f){return b.call(c||d,a,d,e,f)},a)},associate:function(a,c,d){return c||(c=b.requite),d||(d=this),m.reduce.call(this,function(b,e,f){return b[a[f]]=c.call(d,e,f,this),b},b.obj())},clear:function(){return this[c]=0,this},clone:function(){return m.slice.call(this)},compact:function(a){return m.mapc.call(this,a===g?j:b.requite)},contains:function(a){return!!~m.indexOf.call(this,a)},each:function(a,b){return m.forEach.call(this,a,b||this),this},flatten:function(a){if(b.isNum(a)){if(!(a>0))return this;--a}return m.aggregate.call(this,[],function(b,d,e){return Array.isArray(d)?b.splice.apply(b,[b[c],0].concat(d.flatten(a))):b.push(d),b},this)},grep:function(a,c,d){var e=this;return c||(c=b.requite),d||(d=e),!b.isStr(a)||(a=new RegExp(a.escapeRE(),"g")),m.aggregate.call(e,[],function(b,f,g){return!a.test(f)||b.push(c.call(d,f,g,e)),b})},groupBy:function(c,d,f){d||(d=b.requite);var h=this,j,k,l=b.obj();switch(b.type(c)){case"function":k=a;break;case"regexp":k=e;break;case"number":case"string":k=i,j=m.pluck.call(h,c,g);break;default:b.trace().error(new TypeError("Array.prototype.groupBy can only match based on a Function, RegExp or String."),g)}return(j||[0,1]).forEach(function(a){l[a]=[]}),m.aggregate.call(h,l,function(a,b,e){return a[k(c,b)].push(d.call(this,b,e,h)),a},f||h)},include:function(a){return m.contains.call(this,a)?!1:!this.push(a)||g},invoke:function(a){var b=Array.from(arguments,1);return m.map.call(this,function(c,d){return c[a].apply(c,b)})},invokec:function(a){var c=Array.from(arguments,1);return m.mapc.call(this,function(d,e){return b.isFn(d[a])?d[a].apply(d,c):f})},item:function(a){return this[a<0?this[c]+a:a]},last:function(){return this[this[c]-1]},mapc:function(a,c){return c||(c=this),m.reduce.call(this,function(d,e,f,g){return!b.exists(e=a.call(c,e,f,g))||d.push(e),d},[])},pluck:function(a,b){return m[b===g?"mapc":"map"].call(this,function(b){return Object.value(b,a)})},remove:function(){var a=Array.from(arguments),b,c=[],d;while(d=a.shift())!~(b=m.indexOf.call(this,d))||c.push(m.splice.call(this,b,1)[0]);return c},sortBy:function(a,c){return m.map.call(this,l,a).sort(b.isFn(c)?c:n[String(c).lc()]||n.asc).map(k)},tuck:function(a,b){var c=Array.isArray(b);return m.each.call(this,function(d,e){d[a]=c?b[e]:b})},uniq:function(){return m.reduce.call(this,function(a,b){return a.contains(b)||a.push(b),a},[])},without:function(){var a=m.clone.call(this);return a.remove.apply(a,arguments),a},zip:function(){var a=Array.from(arguments);return a.unshift(this),m.map.call(this,function(b,c){return a.pluck(c)})}}}(),h),b.defs(Number,function(){var a=Math.abs,c=9007199254740992,d=Math.floor;return{isInteger:function(a){return b.isNum(a)&&isFinite(a)&&a>-c&&a<c&&d(a)===a},toInteger:function(b){return b=+b,isNaN(b)?0:b===0||!isFinite(b)?b:(b<0?-1:1)*a(d(b))}}}(),"cw"),b.defs(Number[d],{pad:function(a,b){var d=this.toString(b||10);return"0".times(a-d[c])+d},times:function(c,d){return b.range(0,this).forEach(c,d||a),this},toHex:function(){return this.pad(2,16)}},h),b.defs(String[d],function(){function n(a,b){return b+b.lc()}function o(a){a=a.trim();var b=a.charAt(0),c=a.charAt(1),d=b.lc()==b&&c!=" "&&c.uc()==c?2:1,e=a.substring(d).replace(i,n).split(m);return e[0]=a.substring(0,d)+e[0],e}var a=b.obj(),d=b.obj(),e=/([-\*\+\?\.\|\^\$\/\\\(\)[\]\{\}])/g,h="\\$1",i=/([A-Z])/g,j=/\$?\{([^\}]+)\}/g,k=/#?(\w{1,6})/,l=/(\d{1,3})/g,m=/[\sA-Z_-]+/g;return{blank:function(){return!!this.trim().empty()},capitalize:function(){return this.charAt(0).uc()+this.substring(1).lc()},cc:function(){return this.toCamelCase()},clean:function(b){return b||(b=" "),b=a[b]||(a[b]={re:new RegExp("("+b+"){1,}","g"),fill:b}),this.split(b.re).filter(function(a){return!a.blank()&&a!=b.fill}).join(b.fill)},contains:function(a){return!!~this.indexOf(a)},empty:function(){return String(this)===""},format:function(){return this.gsub.call(this,Array.from(arguments))},gsub:function(a,b){return this.replace(b||j,function(b,c){return a[c]||""})},hyphenate:function(){return o(this).join("-").lc()},includes:function(a){return this.lc().contains(String(a).lc())},parts:function(a){var b=Array.from(this.match(a));switch(b[c]){case 1:if(b[0]===f||b[0]===this)return[];default:return b[0]!==this||b.shift(),b}},qw:function(){return this.split(" ")},regexpEsc:function(){return this.replace(e,h)},sliceEvery:function(a){return a=parseInt(a,10),isNaN(a)||this[c]<a||a==0?[String(this)]:this.match(d[a]||(d[a]=new RegExp("(.{1,"+a+"})","g")))},times:function(a){return(new Array(Number.toInteger(a)+1)).join(this)},toCamelCase:function(){var a=o(this),b=[a.shift()];return a.reduce(function(a,b){return a.push(b.capitalize()),a},b).join("")},toHex:function(){function a(a){return parseInt(a,10).pad(2,16)}return function(){var b=this.match(l);return"#"+(b[c]==1?a(b[0]).times(3):b.map(a).join(""))}}(),toJSON:function(){return JSON.parse(this)},toRGB:function(a){var b=this.match(k)[1],d=b[c],e;switch(d){case 6:break;case 3:b=this.times(2);break;case 2:b=this.times(3);break;default:b=d>6?b.substring(0,6):d==4?b+"00":b+"0"}return e=b.sliceEvery(2).map(function(a){return parseInt(a,16)}),a===g?e:"rgb("+e.join(", ")+")"},truncate:function(a,d){return a||(a=50),b.isStr(d)||(d="..."),this[c]<a?String(this):this.substring(0,a).trimRight()+d},uc:function(){return this.toUpperCase()},underscore:function(){return o(this).join("_").lc()}}}(),h),b.ENV!="commonjs"||(module.exports=b)}(this,typeof n8iv=="undefined"?this.document?this.n8iv:require("./n8iv._"):n8iv),!function(a,b){var c=!1,d=null,e=!0,f,g="cw",h="r",i="array",j="constructor",k="function",l="length",m="object",n=d+m,o="prototype",p="__type__";!function(){function i(a,c){!c&&b.isObj(a)&&(c=a,a="");var d,f,i,k=c[j],m=b.obj(),w=c.extend||Object,y=u(c.module),z=c.mixin||I,A=c.singleton,B=v(c.type||a);return!b.isStr(w)||(w=L[w]||M[w]),a&&(i=a.split("."),f=i.pop(),!i[l]||!i[0].startsWith("^")||(y?i.shift():i[0]=i[0].substring(1)),i=b.bless(i,y)),b.def(m,C,b.describe(b.noop,g),e),b.def(m,j,b.describe(s(k,w[o][j],f,m),h),e),d=m[j],b.def(d,p,b.describe("class",h),e),b.def(m,p,b.describe(B,h),e),Object.remove(c,G),d[o]=n(m,b.copy(c,z)),b.def(d,"create",b.describe(q(t(d,w)),h),e),a=a.replace(K,""),A?(b.def(d,"singleton",b.describe({value:A===e?new d:d.create.apply(d,[].concat(A))},h)),x(d,a,B),d=d.singleton):a&&x(d,a,B),!f||!i||b.def(i,f,b.describe({value:d},h)),d}function n(a,c){return Object.each(c,function(c,d){switch(b.type(c)){case m:b.def(a,d,c,e);break;default:a[d]=c}}),a}function q(a){return function(){return y(a)||a.apply(Object.create(a[o]),arguments)}}function s(a,b,c,d){var e=A(a,b,c),f=function(){return y(this.constructor)||e.apply(w(this,f)?this:Object.create(d),arguments)};return f.mimic(a,c)}function t(a,c){if(!(D in a[o])){var d=a[o],f=c[o];Object.keys(f).forEach(function(a){if(a in O)return;switch(b.type(f[a])){case k:d[a]=b.isFn(d[a])?A(d[a],f[a],a):A(f[a],b.noop,a);break;default:a in d||b.def(d,a,b.description(f,a),e)}}),Object.keys(d).forEach(function(a){!b.isFn(d[a])||a in f&&d[a].valueOf()===f[a].valueOf()||(d[a]=A(d[a],b.noop,a))}),f=b.describe({value:Object.create(c[o])},h),b.def(a,D,f),b.def(a[o],D,f)}return a}function u(a){return a?E&&a instanceof E?a.exports||(a.exports=b.obj()):a:d}function v(a){return a.replace(K,"").replace(J,"_").lc()}function w(a,b){if(a instanceof b)return e;if(!(a=a[j]))return c;do if(a===b)return e;while(a[D]&&(a=a[D][j]));return c}function x(a,c,d){var f=c+B,g=[];!c||!(c in L)||g.push(f+"Class"),!d||!(d in M)||g.push(f+"Type"),g[l]&&(b.trace(),g.forEach(b.error),b.error(new Error("n8iv.Class overwrite error."),e)),L[c]=M[d]=a}function y(a){return a?a.singleton||d:d}function z(a){var b=a[j],c;for(c in L)if(L[c]===b)return c;return d}function A(a,d,h){return function(){var h,i=b.description(this,C)||H;return i.writable=e,b.def(this,C,d?b.describe(d,g):H,e),h=a.apply(this,arguments),b.def(this,C,i,e),this.chain!==c&&h===f?this:h}.mimic(a,h)}var B=" already exists. Cannot override existing ",C="parent",D="__super",E=b.ENV!="commonjs"?d:require("module"),G=(j+" extend mixin module singleton type").split(" "),H=b.describe(b.noop,g),I=b.obj(),J=/\./g,K=/^\u005E/,L=b.obj(),M=b.obj(),O=b.obj();O[j]=O[C]=O[D]=O[p]=e,b.def(i,"is",b.describe(w,h)).def(i,"type",b.describe(z,h)).def(b,"Class",b.describe(i,h)).def(b,"create",b.describe(function(c){var d=M[c]||M["n8iv_"+c]||L[c],f=Array.from(arguments,1);return d||b.trace().error(new Error(c+" does not match any registered n8iv.Classes."),e),d.create.apply(a,f)},h))}(),b.Class("n8iv.Callback",function(){function a(){return i in this?this:(this[i]=setTimeout(f.bind(this),this.buffer),this.exec.apply(this,arguments))}function f(){clearTimeout(this[i]),delete this[i]}function g(){return this.fire.apply(this,arguments)}b.def(Function[o],"callback",b.describe(function(a){return(new b.Callback(this,a)).fire.mimic(this)},h));var i="bufferId",j="handleEvent";return{constructor:function(e,f){b.copy(this,f||b.obj());var g=b.describe(d,h),i=(b.isNum(this.buffer)?a:this.exec).bind(this);g.value=e,b.def(this,"fn",g),g.value=this,b.def(i,"cb",g),g.value=i,b.def(this,"fire",g),this.args||(this.args=[]),this.ctx||(this.ctx=this),b.isNum(this.delay)||(this.delay=d),b.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:e,buffer:d,count:0,delay:d,times:0,disable:function(){this.disabled=e,this[j]=b.noop},enable:function(){this.disabled=c,this[j]=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var a=Array.from(arguments),c=this.ctx,e=this.delay,f=b.type(a[0]),g;return f&&(f.endsWith("event")||f=="n8iv_observer")?a.splice.apply(a,[1,0].concat(this.args)):a.unshift.apply(a,this.args),e===d?g=this.fn.apply(c,a):this.fn.delay.apply(this.fn,[e,c].concat(a)),g},reset:function(){this.count=0,f.call(this.enable())}}}()),b.Class("n8iv.Hash",function(){var a="__hashid__",e=[];return{constructor:function(d){b.def(this,a,b.describe(e.push(b.obj())-1,h)),!b.isObj(d)||this.set(d)},keys:{get:function(){return Object.keys(e[this[a]])}},length:{get:function(){return this.keys[l]}},values:{get:function(){return Object.values(e[this[a]])}},aggregate:function(b,c,d){var f=this,g=e[this[a]];return d||(d=f),Object.keys(g).reduce(function(a,b,e){return c.call(d,a,g[b],b,f,e)},b)},clear:function(){e[this[a]]=b.obj()},clone:function(){return new b.Hash(Object.clone(e[this[a]]))},each:function(b,c){var d=this,f=e[this[a]];return c||(c=d),Object.keys(f).forEach(function(a,e){b.call(c,f[a],a,d,e)},d),d},get:function(c){return b.has(e[this[a]],c)?e[this[a]][c]:d},has:function(c){return b.has(e[this[a]],c)},key:function(b){return Object.key(e[this[a]],b)},reduce:function(b,c){var d=this,f=e[this[a]];return Object.keys(f).reduce(function(a,c,e){return b.call(d,a,f[c],c,d,e)},c)},remove:function(d){return b.has(e[this[a]],d)?delete e[this[a]][d]:c},set:function(c,d){switch(b.type(c)){case m:case n:Object.keys(c).forEach(function(a){this.set(a,c[a])},this);break;default:e[this[a]][c]=d}},stringify:function(){return JSON.stringify(e[this[a]])},toString:function(){return b.tostr(e[this[a]])},valueOf:function(){return Object.clone(e[this[a]])}}}()),b.Class("n8iv.Observer",function(){function a(a){a=Object.clone(a);var c=a[t],d,e,f,g=a[x],h;Object.remove(a,t,x);for(d in a){e=a[d],f=b.isUndef(e[x])?g:e[x],h=b.isUndef(e[t])?c:e[t];switch(b.type(e)){case k:this.on(d,e,c,g);break;case m:case n:switch(b.type(e[v])){case k:case m:case n:this.on(d,e[v],h,f);break;case i:e[v].forEach(function(a){this.on(d,a,h,f)},this)}break;case i:e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function f(a){var d=this.args.concat(a[x].args),f=a[t]||this[t],g=a.fire||a[v];return b.isFn(g)?(Object.key(this[t],a[v])?d[0]!==this[t]||d.shift():d[0]!==this[t]&&d.unshift(this[t]),g.apply(f,d)!==c):e}function g(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),r.apply(b,e)}}function h(a,b){var c=this;return b.fire=function(){c.un(a,b[v],b[t]);if(b.fired)return;return b.fired=e,b[v].apply(b[t]||c,arguments)}}function j(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function o(a,c,f){a=a.lc();var g=this[w].get(a),h,i;if(!g)return;switch(b.type(c)){case"n8iv_callback":i={ctx:c,isCB:e};break;default:i={ctx:f||this,fn:c}}i.event=a,i=g.find(p,i),i!==d&&(h=g.indexOf(i),h<0||g.splice(h,1))}function p(a){return(this.isCB===e?a[v].valueOf()===this[t].fire:a[v]===this[v])&&a[t]===this[t]&&a.event===this.event}function q(c,d,e,f){var g,k=this[w],l,o;if(b.isObj(c))return a.call(this,c);switch(l=b.nativeType(d)){case i:return g=b.obj(),g[c]={fn:d,options:f,ctx:e},a.call(this,g);case m:case n:case"n8iv_callback":"handleEvent"in d&&(!b.isObj(e)||!b.isUndef(f)||(f=e),e=d,d=j(d));break;case"string":!e||(d=e[d])}c=c.lc(),(o=k.get(c))||k.set(c,o=[]);switch(b.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case m:case n:f=Object.clone(f);break;default:f=b.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:e||this,event:c,fn:d,id:++z,options:f},g.fire=(f.single?h.call(this,c,g):g[v]).callback({args:f.args,buffer:f.buffer,ctx:g[t],delay:f.delay}),o.push(g)}function r(){return this.broadcast.apply(this,arguments)}var s="broadcasting",t="ctx",u="destroyed",v="fn",w="listeners",x="options",y="observer_suspended",z=0;return{constructor:function(d){this[s]=c,this[u]=c,this[y]=c,this[w]=b.Hash.create(),!b.isObj(d)||this.on(d),!b.isObj(this.observers)||this.on(this.observers),delete this.observers},broadcast:function(a){if(this[u]||this[y]||!this[w][l]||!a||!this[w].has(a=a.lc()))return;var b=Array.from(arguments,1),d=this[w].get(a).clone();if(!d[l])return;this[s]=a,d.every(f,{args:b,ctx:this}),this[s]=c},buffer:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.buffer=Number.toInteger(a),this.on(c,d,e,f)},delay:function(a,c,d,e,f){b.isObj(f)||(f=b.obj()),f.delay=Number.toInteger(a),this.on(c,d,e,f)},destroy:function(){return this[u]?e:this.broadcast("before:destroy")===c?c:(this[u]=e,this._destroy(),this.broadcast("destroy"),this[y]=e,delete this[w],e)},ignore:o,observe:q,on:q,once:function(a,c,d,f){b.isObj(f)||(f=b.obj()),f.single=e,this.on(a,c,d,f)},purgeObservers:function(a){var b=this[w];if(!a){b.clear();return}a=a.lc(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,g(this,a,c),a)},resumeEvents:function(){!this[y]||(this[y]=c,this.broadcast("observer:resumed"))},suspendEvents:function(){this[y]||(this[y]=e,this.broadcast("observer:suspended"))},un:o,_destroy:b.noop}}()),b.ENV!="commonjs"||(module.exports=b)}(this,typeof n8iv=="undefined"?this.document?this.n8iv:require("./n8iv._"):n8iv)
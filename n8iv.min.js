!function(){function h(a,b,c,d){return d||(d=a),Object.keys(a).reduce(function(b,e,f){return c.call(d,b,a[e],e,a,f)},b)}function i(a){return Object.keys(a).forEach(function(b){delete a[b]},a),a}function j(b,c){switch(a.type(b)){case"array":return Array.isArray(c)?k(b,c):d;case"object":return a.isObj(c)?l(b,c):d;case"date":return+b==+c}return b==c}function k(a,c){return a[b]==c[b]&&Array.from(a).every(function(a,b){return j(c[b],a)})}function l(b,c){if(Object.len(b)!==Object.len(c)||n(b)!==n(c))return d;for(var e in c)if(a.has(b,e)!==a.has(c,e)||!j(b[e],c[e]))return d;return f}function m(a){return Object.getOwnPropertyNames(a)}function n(a){return m(a)[b]}function o(a,b,c){return Object.keys(a).reduce(function(c,d,e){return b.call(a,c,a[d],d,a,e)},c)}var a=function(a){function b(a,b,c){return n(a,W)?bu.call(a,H(b)?b>0?b:0:0,H(c)?c>b?c:b+1:a[W]):[a]}function c(a,b){switch(C(a)){case P:break;case _:a=a.split(".");break;default:return d(b)}return br.test(a[0])&&(b=bm,a.shift()),a[W]?(!a[0].startsWith("^")||(b?a.shift():a[0]=a[0].substring(1)),b=d(b),a.forEach(function(a){if(!a)return;n(b,a)||(b[a]=s()),b=b[a]}),b):d(b)}function d(b){return bc==R?b?b instanceof be?b[U]:b:module[U]:b||a}function e(a){switch(C(a)){case L:return L;case Q:return a;case X:return a!==0&&!isNaN(a);case _:return!bf.some(function(b){return b===a});default:return a===O||a===M?L:N}}function f(a,b,c){return isNaN(b=Number(a))?(c=String(a))in bg?bg[c]:a:b}function g(a,b,c){c=c===N;for(var d in b)!o(b,d)||c&&o(a,d)||(a[d]=b[d]);return a}function h(a,b,c,d,e){var f=n(a,b);return!c.get&&!c.set||delete c.writable,d===N||!f?Object.defineProperty(a,b,c):e===N&&f&&y().error(new Error("Trying to overwrite existing property: "+b+", in: "+(G(a)?a.n8ivName:a[S].n8ivName)+"."),N),bm}function i(a,b,c,d,e){c||(c=bi);for(var f in b)!o(b,f)||h(a,f,j(b[f],c),d,e);return bm}function j(a,b){return g(I(a,N)?a:{value:a},I(b)?b:bl[p(b)]||bl.cew)}function k(a,b){return Object.getOwnPropertyDescriptor(a,b)}function l(a,b){var c;switch(C(a)){case T:c=a.message;break;case _:c=String(a),a=new Error(a)}!(T in console)||console.error(c);if(b===N)throw a;return bm}function m(a){return a!==M&&a!==O&&(typeof a==X?!isNaN(a):N)}function n(a,b){return b in Object(a)}function o(a,b){return bd.hasOwnProperty.call(a,b)}function p(a){return String(a).toLowerCase()}function q(a,b){return a?n(a,"id")?a.id:a.id=r(b):r(b)}function r(a){return(a||bk)+ ++bj}function s(a,b){return(b=Object.create(M))&&arguments[W]>=1?g(b,a):b}function t(a){return Object.getPrototypeOf(a)}function u(){}function v(a,b){var c=[a];while(++a<=b)c.push(a);return c}function w(a){return a}function x(a){return bd.toString.call(a)}function y(){return!("trace"in console)||console.trace(),bm}function z(a){return bd.valueOf.call(a)}function A(){var a=this[S],b=D(this),c=bc!=R?B(b):bq.test(b)?"global":L;return c||(b==Y&&a[ba]!=V?a[ba]||p(a.n8ivName)||b:b)}function B(a){return bo.test(a)?"htmlcollection":bp.test(a)?"htmlelement":bq.test(a)?"global":L}function C(a){return a===M||a===O?L:a[ba]||(t(a)===M?Z:O)}function D(a,b){return(b=x(a))in bv?bv[b]:bv[b]=p(b).match(bs)[1].replace(bt,"$1")}function E(a){return C(a)==Q}function F(a){switch(C(a)){case P:return!a[W];case X:return isNaN(a);case Y:return!Object.len(a);case _:return a==="";default:return!m(a)}}function G(a){return typeof a==V}function H(a){return C(a)==X&&!isNaN(a)}function I(a,b){var c=C(a);return c==Y&&D(a)==Y||b!==N&&c==Z}function J(a){return C(a)==_}function K(a){return typeof a==bb}var L=!1,M=null,N=!0,O,P="array",Q="boolean",R="commonjs",S="constructor",T="error",U="exports",V="function",W="length",X="number",Y="object",Z=M+Y,$="prototype",_="string",ba="__type__",bb=""+O,bc=typeof module!=bb&&U in module?R:typeof navigator!=bb?"browser":"other",bd=Object[$],be=bc!=R?M:require("module"),bf=[0,L,"",NaN,M,O].map(String),bg=[L,NaN,M,N,O].reduce(function(a,b){return a[String(b)]=b,a},s()),bh="c",bi="cw",bj=999,bk="anon__",bl=function(){var a="configurable enumerable writable".split(" "),b={ce:"ec",cw:"wc",ew:"we",cew:"cwe ecw ewc wce wec".split(" ")},c={c:[N,L,L],ce:[N,N,L],cew:[N,N,N],cw:[N,L,N],e:[L,N,L],ew:[L,N,N],r:[L,L,L],w:[L,L,N]},d=Object.keys(c).reduce(function(d,e){return d[e]=a.reduce(function(a,b,d){return a[b]=c[e][d],a},s()),e in b&&typeof b[e]!=_?b[e].forEach(function(a){d[a]=d[e]}):d[b[e]]=d[e],d},s());return delete d[bb],d}(),bm=s(),bn="r",bo=/htmlcollection|nodelist/,bp=/^html\w+?element$/,bq=/global|window/i,br=/^\u005E?n8iv/,bs=/\[[^\s]+\s([^\]]+)\]/,bt=/^[Ww]ebkit|[Mm]oz|O|[Mm]s|[Kk]html(.*)$/,bu=Array[$].slice,bv={"[object Object]":Y};return h(bd,ba,g({get:A},bl.r)),h(Array,"from",j(b,bn)),i(Object,{clone:function(a){return g(s(),a)},each:function(a,b,c){return c||(c=a),Object.keys(a).forEach(function(d,e){b.call(c,a[d],d,a,e)},a),a},key:function(a,b){for(var c in a)if(a[c]===b)return c;return M},len:function(a){return Object.keys(a)[W]},remove:function(a,c){return(Array.isArray(c)?c:b(arguments,1)).forEach(function(b){delete a[b]}),a},value:function(a,b){if(isNaN(b)&&!!~b.indexOf(".")){var c;b=b.split(".");while(c=b.shift()){a=Object.value(a,c);if(a===O)return a}return a}return F(a)?O:F(a[b])?G(a.get)?a.get(b):G(a.getAttribute)?a.getAttribute(b):O:a[b]},values:function(a){return Object.keys(a).map(function(b){return a[b]})}},bn),h(Array[$],"find",j(function(a,b){var c=-1,d=this[W]>>>0;b||(b=this);while(++c<d)if(!!a.call(b,this[c],c,this))return this[c];return M},bn)),i(Function[$],{n8ivName:{get:function(){var a="anonymous",b=["",""],c="__n8ivName__",d=/[\s\(]*function([^\(]+).*/;return function(){if(!this[c]){var f=this.valueOf(),g=f!==this?f.n8ivName!==a?f.n8ivName:M:M,i=this.name||this.displayName||(String(this).match(d)||b)[1].trim();h(this,c,j(g||i||a,"w"))}return this[c]}}()},bind:function(c){var d=b(arguments,1),e=function(){return f.apply(this instanceof e?this:c||a,d.concat(b(arguments)))},f=this;return e[$]=Object.create(f[$]),e.mimic(f)},mimic:function(a,b){return Object.defineProperties(this,{displayName:j(b||a.n8ivName,bh),toString:j(function(){return a.valueOf().toString()},bh),valueOf:j(function(){return a},bh)})}},bn),i(String[$],{endsWith:function(a){return this[W]&&this.lastIndexOf(a)==this[W]-a[W]},lc:function(){return p(this)},startsWith:function(a){return!this.indexOf(a)}},bn),typeof global==bb||(a=global),bc!=R?h(a,"n8iv",j({value:bm},bn)):module[U]=bm,i(bm,{ENV:bc,modes:bl,global:{value:a},bless:c,bool:e,coerce:f,copy:g,def:h,defs:i,describe:j,description:k,error:l,exists:m,got:n,has:o,id:q,isBool:E,isEmpty:F,isFn:G,isNum:H,isObj:I,isStr:J,isUndef:K,nativeType:D,noop:u,obj:s,proto:t,range:v,requite:w,tostr:x,trace:y,type:C,valof:z},bn),bm}(this),b="length",c="prototype",d=!1,e=null,f=!0,g="r";a.defs(Object,{aggregate:h,clear:i,equalTo:j,ownKeys:m,ownLen:n,reduce:o},g),a.defs(Function[c],function(){var c=/^[\s\(]*function[^\(]*\(([^\)]*)\)/,d=/\s*,\s*/;return a.def(Function,"from",a.describe(function(c){return a.isFn(c)?c:function(){return c}},g)),{params:{get:function(){var a=String(this).match(c)[1].trim().split(d);return a[b]==1&&!a[0]?[]:a}},attempt:function(a){var b=Array.from(arguments,1),c=this;return function(){try{return c.apply(a||this,b)}catch(e){return e}}()},bake:function(){var b="baked",c=this;return c[b]||!a.def(c,b,a.describe(function(){return c.apply(this,[this].concat(Array.from(arguments)))}.mimic(c),g))||c[b]},defer:a.ENV=="commonjs"?function(a){return process.nextTick(this.bind.apply(this,[a].concat(Array.from(arguments,1))))}:function(){return this.delay.apply(this,[1].concat(Array.from(arguments)))},delay:function(b,c){function f(){return f.stop(),e.apply(c||this,d)}var d=Array.from(arguments,2),e=this;return a.copy(f,{stop:function(){return clearTimeout(this.timeoutId),delete this.timeoutId,e},timeoutId:setTimeout(f,b)})},memoize:function(b){function d(){var a=Array.from(arguments),d=a.toString();return d in b?b[d]:b[d]=c.apply(this,a)}var c=this;return a.isObj(b)||(b=a.obj()),d.unmemoize=function(){return c},d},stop:function(){return this},unmemoize:function(){return this},wrap:function(a){var b=Array.from(arguments,1),c=this;return function(){return a.apply(this,[c.bind(this)].concat(b).concat(Array.from(arguments)))}.mimic(a)}}}(),g),a.defs(Array[c],function(){function d(a,b){return a(b)?0:1}function h(a,b){return a.test(b)?0:1}function i(a,b){return Object.value(b,a)||1}function j(a){return a?a:e}function k(a){return a[0]}function l(b){return[b,a.isFn(this)?this(b):Object.value(b,this)]}var m=Array[c],n={desc:function(a,b){return a[1]==b[1]?0:a[1]<b[1]?1:-1},asc:function(a,b){return a[1]==b[1]?0:a[1]>b[1]?1:-1}};return n[String(f)]=n[1]=n.asc,n[String(!1)]=n[0]=n.desc,a.def(Array,"sortFns",a.describe({value:n},g)),{aggregate:function(a,b,c){return m.reduce.call(this,function(a,d,e,f){return b.call(c||d,a,d,e,f)},a)},associate:function(b,c,d){return c||(c=a.requite),d||(d=this),m.reduce.call(this,function(a,e,f){return a[b[f]]=c.call(d,e,f,this),a},a.obj())},clear:function(){return this[b]=0,this},clone:function(){return m.slice.call(this)},compact:function(b){return m.mapc.call(this,b===f?j:a.requite)},contains:function(a){return!!~m.indexOf.call(this,a)},each:function(a,b){return m.forEach.call(this,a,b||this),this},flatten:function(c){if(a.isNum(c)){if(!(c>0))return this;--c}return m.aggregate.call(this,[],function(a,d,e){return Array.isArray(d)?a.splice.apply(a,[a[b],0].concat(d.flatten(c))):a.push(d),a},this)},grep:function(b,c,d){var e=this;return c||(c=a.requite),d||(d=e),!a.isStr(b)||(b=new RegExp(b.escapeRE(),"g")),m.aggregate.call(e,[],function(a,f,g){return!b.test(f)||a.push(c.call(d,f,g,e)),a})},groupBy:function(b,c,e){c||(c=a.requite);var g=this,j,k,l=a.obj();switch(a.type(b)){case"function":k=d;break;case"regexp":k=h;break;case"number":case"string":k=i,j=m.pluck.call(g,b,f);break;default:a.trace().error(new TypeError("Array.prototype.groupBy can only match based on a Function, RegExp or String."),f)}return(j||[0,1]).forEach(function(a){l[a]=[]}),m.aggregate.call(g,l,function(a,d,e){return a[k(b,d)].push(c.call(this,d,e,g)),a},e||g)},include:function(a){return m.contains.call(this,a)?!1:!this.push(a)||f},invoke:function(a){var b=Array.from(arguments,1);return m.map.call(this,function(c,d){return c[a].apply(c,b)})},invokec:function(b){var c=Array.from(arguments,1);return m.mapc.call(this,function(d,f){return a.isFn(d[b])?d[b].apply(d,c):e})},item:function(a){return this[a<0?this[b]+a:a]},last:function(){return this[this[b]-1]},mapc:function(b,c){return c||(c=this),m.reduce.call(this,function(d,e,f,g){return!a.exists(e=b.call(c,e,f,g))||d.push(e),d},[])},pluck:function(a,b){return m[b===f?"mapc":"map"].call(this,function(b){return Object.value(b,a)})},remove:function(){var a=Array.from(arguments),b,c=[],d;while(d=a.shift())!~(b=m.indexOf.call(this,d))||c.push(m.splice.call(this,b,1)[0]);return c},sortBy:function(b,c){return m.map.call(this,l,b).sort(a.isFn(c)?c:n[String(c).lc()]||n.asc).map(k)},tuck:function(a,b){var c=Array.isArray(b);return m.each.call(this,function(d,e){d[a]=c?b[e]:b})},uniq:function(){return m.reduce.call(this,function(a,b){return a.contains(b)||a.push(b),a},[])},without:function(){var a=m.clone.call(this);return a.remove.apply(a,arguments),a},zip:function(){var a=Array.from(arguments);return a.unshift(this),m.map.call(this,function(b,c){return a.pluck(c)})}}}(),g),a.defs(Number,function(){var b=Math.abs,c=9007199254740992,d=Math.floor;return{isInteger:function(b){return a.isNum(b)&&isFinite(b)&&b>-c&&b<c&&d(b)===b},toInteger:function(a){return a=+a,isNaN(a)?0:a===0||!isFinite(a)?a:(a<0?-1:1)*b(d(a))}}}(),"cw"),a.defs(Number[c],{pad:function(a,c){var d=this.toString(c||10);return"0".times(a-d[b])+d},times:function(b,c){return a.range(0,this).forEach(b,c||a.global),this},toHex:function(){return this.pad(2,16)}},g),a.defs(String[c],function(){function n(a,b){return b+b.lc()}function o(a){a=a.trim();var b=a.charAt(0),c=a.charAt(1),d=b.lc()==b&&c!=" "&&c.uc()==c?2:1,e=a.substring(d).replace(i,n).split(m);return e[0]=a.substring(0,d)+e[0],e}var c=a.obj(),d=a.obj(),g=/([-\*\+\?\.\|\^\$\/\\\(\)[\]\{\}])/g,h="\\$1",i=/([A-Z])/g,j=/\$?\{([^\}]+)\}/g,k=/#?(\w{1,6})/,l=/(\d{1,3})/g,m=/[\sA-Z_-]+/g;return{blank:function(){return!!this.trim().empty()},capitalize:function(){return this.charAt(0).uc()+this.substring(1).lc()},cc:function(){return this.toCamelCase()},clean:function(a){return a||(a=" "),a=c[a]||(c[a]={re:new RegExp("("+a+"){1,}","g"),fill:a}),this.split(a.re).filter(function(b){return!b.blank()&&b!=a.fill}).join(a.fill)},contains:function(a){return!!~this.indexOf(a)},empty:function(){return String(this)===""},format:function(){return this.gsub.call(this,Array.from(arguments))},gsub:function(a,b){return this.replace(b||j,function(b,c){return a[c]||""})},hyphenate:function(){return o(this).join("-").lc()},includes:function(a){return this.lc().contains(String(a).lc())},parts:function(a){var c=Array.from(this.match(a));switch(c[b]){case 1:if(c[0]===e||c[0]===this)return[];default:return c[0]!==this||c.shift(),c}},qw:function(){return this.split(" ")},regexpEsc:function(){return this.replace(g,h)},sliceEvery:function(a){return a=parseInt(a,10),isNaN(a)||this[b]<a||a==0?[String(this)]:this.match(d[a]||(d[a]=new RegExp("(.{1,"+a+"})","g")))},times:function(a){return(new Array(Number.toInteger(a)+1)).join(this)},toCamelCase:function(){var a=o(this),b=[a.shift()];return a.reduce(function(a,b){return a.push(b.capitalize()),a},b).join("")},toHex:function(){function a(a){return parseInt(a,10).pad(2,16)}return function(){var c=this.match(l);return"#"+(c[b]==1?a(c[0]).times(3):c.map(a).join(""))}}(),toJSON:function(){return JSON.parse(this)},toRGB:function(a){var c=this.match(k)[1],d=c[b],e;switch(d){case 6:break;case 3:c=this.times(2);break;case 2:c=this.times(3);break;default:c=d>6?c.substring(0,6):d==4?c+"00":c+"0"}return e=c.sliceEvery(2).map(function(a){return parseInt(a,16)}),a===f?e:"rgb("+e.join(", ")+")"},truncate:function(c,d){return c||(c=50),a.isStr(d)||(d="..."),this[b]<c?String(this):this.substring(0,c).trimRight()+d},uc:function(){return this.toUpperCase()},underscore:function(){return o(this).join("_").lc()}}}(),g);var d=!1,e=null,f=!0,p,q="cw",g="r",r="array",s="constructor",t="function",b="length",u="object",v=e+u,c="prototype",w="__type__";!function(){function h(b,d){!d&&a.isObj(b)&&(d=b,b="");var e,h,n,p,r=a.obj(),t=d.extend||Object,u=d.module,v=d.mixin||D,x=d.singleton,y=m(d.type||b);return!a.isStr(t)||(t=H[t]||I[t]),p=d[s]!==Object?d[s]:t,b&&(n=b.split("."),h=n.pop(),n=a.bless(n,u)),a.def(r,z,a.describe(a.noop,q),f),a.def(r,s,a.describe(k(p,t[c][s],h,r),g),f),e=r[s],a.def(e,w,a.describe("class",g),f),a.def(r,w,a.describe(y,g),f),Object.remove(d,B),e[c]=i(r,a.copy(d,v)),a.def(e,"create",a.describe(j(l(e,t)),g),f),b=b.replace(G,""),x?(a.def(e,"singleton",a.describe({value:x===f?new e:e.create.apply(e,[].concat(x))},g)),o(e,b,y),e=e.singleton):b&&o(e,b,y),!h||!n||a.def(n,h,a.describe({value:e},g)),e}function i(b,c){return Object.each(c,function(c,d){switch(a.type(c)){case u:a.def(b,d,c,f);break;default:b[d]=c}}),b}function j(a){return function(){return r(a)||a.apply(Object.create(a[c]),arguments)}}function k(a,b,c,d){var e=x(a,b,c),f=function(){return r(this.constructor)||e.apply(n(this,f)?this:Object.create(d),arguments)};return f.mimic(a,c)}function l(b,d){if(!(A in b[c])){var e=b[c],h=d[c];Object.keys(h).forEach(function(b){if(b in J)return;switch(a.type(h[b])){case t:e[b]=a.isFn(e[b])?x(e[b],h[b],b):x(h[b],a.noop,b);break;default:b in e||a.def(e,b,a.description(h,b),f)}}),Object.keys(e).forEach(function(b){!a.isFn(e[b])||b in h&&e[b].valueOf()===h[b].valueOf()||(e[b]=x(e[b],a.noop,b))}),h=a.describe({value:Object.create(d[c])},g),a.def(b,A,h),a.def(b[c],A,h)}return b}function m(a){return a.replace(G,"").replace(E,"_").lc()}function n(a,b){if(a instanceof b)return f;if(!(a=a[s]))return d;do if(a===b)return f;while(a[A]&&(a=a[A][s]));return d}function o(c,d,e){var g=d+y,h=[];!d||!(d in H)||h.push(g+"Class"),!e||!(e in I)||h.push(g+"Type"),h[b]&&(a.trace(),h.forEach(a.error),a.error(new Error("n8iv.Class overwrite error."),f)),H[d]=I[e]=c}function r(a){return a?a.singleton||e:e}function v(a){var b=a[s],c;for(c in H)if(H[c]===b)return c;return e}function x(b,c,e){return function(){var e,g=a.description(this,z)||C;return g.writable=f,a.def(this,z,c?a.describe(c,q):C,f),e=b.apply(this,arguments),a.def(this,z,g,f),this.chain!==d&&e===p?this:e}.mimic(b,e)}var y=" already exists. Cannot override existing ",z="parent",A="__super",B=(s+" extend mixin module singleton type").split(" "),C=a.describe(a.noop,q),D=a.obj(),E=/\./g,G=/^\u005E/,H=a.obj(),I=a.obj(),J=a.obj();J[s]=J[z]=J[A]=J[w]=f,a.def(h,"is",a.describe(n,g)).def(h,"type",a.describe(v,g)).def(a,"Class",a.describe(h,g)).def(a,"create",a.describe(function(b){var c=I[b]||I["n8iv_"+b]||H[b],d=Array.from(arguments,1);return c||a.trace().error(new Error(b+" does not match any registered n8iv.Classes."),f),c.create.apply(a.global,d)},g))}(),a.Class("n8iv.Callback",function(){function b(){return j in this?this:(this[j]=setTimeout(h.bind(this),this.buffer),this.exec.apply(this,arguments))}function h(){clearTimeout(this[j]),delete this[j]}function i(){return this.fire.apply(this,arguments)}a.def(Function[c],"callback",a.describe(function(b){return(new a.Callback(this,b)).fire.mimic(this)},g));var j="bufferId",k="handleEvent";return{constructor:function(d,f){a.copy(this,f||a.obj());var h=a.describe(e,g),i=(a.isNum(this.buffer)?b:this.exec).bind(this);h.value=d,a.def(this,"fn",h),h.value=this,a.def(i,"cb",h),h.value=i,a.def(this,"fire",h),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.isNum(this.delay)||(this.delay=e),a.isNum(this.times)&&this.times>0||(this.times=0),this.enable()},chain:f,buffer:e,count:0,delay:e,times:0,disable:function(){this.disabled=f,this[k]=a.noop},enable:function(){this.disabled=d,this[k]=i},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var b=Array.from(arguments),c=this.ctx,d=this.delay,f=a.type(b[0]),g;return f&&(f.endsWith("event")||f=="n8iv_observer")?b.splice.apply(b,[1,0].concat(this.args)):b.unshift.apply(b,this.args),d===e?g=this.fn.apply(c,b):this.fn.delay.apply(this.fn,[d,c].concat(b)),g},reset:function(){this.count=0,h.call(this.enable())}}}()),a.Class("n8iv.Hash",function(){var c="__hashid__",f=[];return{constructor:function(d){a.def(this,c,a.describe(f.push(a.obj())-1,g)),!a.isObj(d)||this.set(d)},keys:{get:function(){return Object.keys(f[this[c]])}},length:{get:function(){return this.keys[b]}},values:{get:function(){return Object.values(f[this[c]])}},aggregate:function(a,b,d){var e=this,g=f[this[c]];return d||(d=e),Object.keys(g).reduce(function(a,c,f){return b.call(d,a,g[c],c,e,f)},a)},clear:function(){f[this[c]]=a.obj()},clone:function(){return new a.Hash(Object.clone(f[this[c]]))},each:function(a,b){var d=this,e=f[this[c]];return b||(b=d),Object.keys(e).forEach(function(c,f){a.call(b,e[c],c,d,f)},d),d},get:function(b){return a.has(f[this[c]],b)?f[this[c]][b]:e},has:function(b){return a.has(f[this[c]],b)},key:function(a){return Object.key(f[this[c]],a)},reduce:function(a,b){var d=this,e=f[this[c]];return Object.keys(e).reduce(function(b,c,f){return a.call(d,b,e[c],c,d,f)},b)},remove:function(b){return a.has(f[this[c]],b)?delete f[this[c]][b]:d},set:function(b,d){switch(a.type(b)){case u:case v:Object.keys(b).forEach(function(a){this.set(a,b[a])},this);break;default:f[this[c]][b]=d}},stringify:function(){return JSON.stringify(f[this[c]])},toString:function(){return a.tostr(f[this[c]])},valueOf:function(){return Object.clone(f[this[c]])}}}()),a.Class("n8iv.Observer",function(){function c(b){b=Object.clone(b);var c=b[p],d,e,f,g=b[x],h;Object.remove(b,p,x);for(d in b){e=b[d],f=a.isUndef(e[x])?g:e[x],h=a.isUndef(e[p])?c:e[p];switch(a.type(e)){case t:this.on(d,e,c,g);break;case u:case v:switch(a.type(e[s])){case t:case u:case v:this.on(d,e[s],h,f);break;case r:e[s].forEach(function(a){this.on(d,a,h,f)},this)}break;case r:e.forEach(function(a){this.on(d,a,c,g)},this)}}return this}function g(b){var c=this.args.concat(b[x].args),e=b[p]||this[p],g=b.fire||b[s];return a.isFn(g)?(Object.key(this[p],b[s])?c[0]!==this[p]||c.shift():c[0]!==this[p]&&c.unshift(this[p]),g.apply(e,c)!==d):f}function h(a,b,c){return function(){var e=Array.from(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),n.apply(b,e)}}function i(a,b){var c=this;return b.fire=function(){c.un(a,b[s],b[p]);if(b.fired)return;return b.fired=f,b[s].apply(b[p]||c,arguments)}}function j(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function k(b,c,d){b=b.lc();var g=this[w].get(b),h,i;if(!g)return;switch(a.type(c)){case"n8iv_callback":i={ctx:c,isCB:f};break;default:i={ctx:d||this,fn:c}}i.event=b,i=g.find(l,i),i!==e&&(h=g.indexOf(i),h<0||g.splice(h,1))}function l(a){return(this.isCB===f?a[s].valueOf()===this[p].fire:a[s]===this[s])&&a[p]===this[p]&&a.event===this.event}function m(b,d,e,f){var g,h=this[w],k,l;if(a.isObj(b))return c.call(this,b);switch(k=a.nativeType(d)){case r:return g=a.obj(),g[b]={fn:d,options:f,ctx:e},c.call(this,g);case u:case v:case"n8iv_callback":"handleEvent"in d&&(!a.isObj(e)||!a.isUndef(f)||(f=e),e=d,d=j(d));break;case"string":!e||(d=e[d])}b=b.lc(),(l=h.get(b))||h.set(b,l=[]);switch(a.type(f)){case"boolean":f={single:!!f};break;case"number":f={delay:f};break;case u:case v:f=Object.clone(f);break;default:f=a.obj()}Array.isArray(f.args)||(f.args=[]),g={ctx:e||this,event:b,fn:d,id:++z,options:f},g.fire=(f.single?i.call(this,b,g):g[s]).callback({args:f.args,buffer:f.buffer,ctx:g[p],delay:f.delay}),l.push(g)}function n(){return this.broadcast.apply(this,arguments)}var o="broadcasting",p="ctx",q="destroyed",s="fn",w="listeners",x="options",y="observer_suspended",z=0;return{constructor:function(c){this[o]=d,this[q]=d,this[y]=d,this[w]=a.Hash.create(),!a.isObj(c)||this.on(c),!a.isObj(this.observers)||this.on(this.observers),delete this.observers},broadcast:function(a){if(this[q]||this[y]||!this[w][b]||!a||!this[w].has(a=a.lc()))return;var c=Array.from(arguments,1),e=this[w].get(a).clone();if(!e[b])return;this[o]=a,e.every(g,{args:c,ctx:this}),this[o]=d},buffer:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.buffer=Number.toInteger(b),this.on(c,d,e,f)},delay:function(b,c,d,e,f){a.isObj(f)||(f=a.obj()),f.delay=Number.toInteger(b),this.on(c,d,e,f)},destroy:function(){return this[q]?f:this.broadcast("before:destroy")===d?d:(this[q]=f,this._destroy(),this.broadcast("destroy"),this[y]=f,delete this[w],f)},ignore:k,observe:m,on:m,once:function(b,c,d,e){a.isObj(e)||(e=a.obj()),e.single=f,this.on(b,c,d,e)},purgeObservers:function(a){var b=this[w];if(!a){b.clear();return}a=a.lc(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.from(arguments,1),c;while(c=b.shift())this.on(c,h(this,a,c),a)},resumeEvents:function(){!this[y]||(this[y]=d,this.broadcast("observer:resumed"))},suspendEvents:function(){this[y]||(this[y]=f,this.broadcast("observer:suspended"))},un:k,_destroy:a.noop}}()),a.ENV!="commonjs"||module.exports===a||(module.exports=a)}()